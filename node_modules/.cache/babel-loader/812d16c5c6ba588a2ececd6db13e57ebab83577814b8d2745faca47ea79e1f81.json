{"ast":null,"code":"import _classPrivateFieldLooseBase from\"/Users/dawso/Desktop/beat-1/node_modules/@babel/runtime/helpers/esm/classPrivateFieldLooseBase.js\";import _classPrivateFieldLooseKey from\"/Users/dawso/Desktop/beat-1/node_modules/@babel/runtime/helpers/esm/classPrivateFieldLooseKey.js\";import{TrackProvider}from\"./TrackProvider.js\";/**\n * Minimal Spotify Web API wrapper for Recommendations + Audio Features.\n * Works with a pasted OAuth token (no backend needed).\n */var _token=/*#__PURE__*/_classPrivateFieldLooseKey(\"token\");var _fetchAudioFeatures=/*#__PURE__*/_classPrivateFieldLooseKey(\"fetchAudioFeatures\");var _fetchJSON=/*#__PURE__*/_classPrivateFieldLooseKey(\"fetchJSON\");export default class SpotifyTrackProvider extends TrackProvider{constructor(token){super();Object.defineProperty(this,_fetchJSON,{value:_fetchJSON2});Object.defineProperty(this,_fetchAudioFeatures,{value:_fetchAudioFeatures2});Object.defineProperty(this,_token,{writable:true,value:void 0});_classPrivateFieldLooseBase(this,_token)[_token]=token;}// Map your workout to seed genres (tweak to taste)\nstatic genreFromWorkout(workout){const map={cardio:\"pop\",strength:\"rock\",yoga:\"ambient\",hiit:\"edm\",warmup:\"dance\",cooldown:\"chill\"};return map[workout]||\"workout\";}static tempoWindowFromHR(hr){const target=Math.max(40,Math.min(220,Math.round(hr)));const min=Math.max(40,target-20);const max=Math.min(220,target+20);return{min,target,max};}async getRecommendations(bpm,workout){const genre=SpotifyTrackProvider.genreFromWorkout(workout);const{min,target,max}=SpotifyTrackProvider.tempoWindowFromHR(bpm);// 1) /v1/recommendations\nconst params=new URLSearchParams({limit:\"20\",market:\"from_token\",seed_genres:genre,target_tempo:String(target),min_tempo:String(min),max_tempo:String(max),min_energy:\"0.3\",min_danceability:\"0.3\"});const rec=await _classPrivateFieldLooseBase(this,_fetchJSON)[_fetchJSON](\"https://api.spotify.com/v1/recommendations?\".concat(params.toString()));const tracks=Array.isArray(rec===null||rec===void 0?void 0:rec.tracks)?rec.tracks:[];if(!tracks.length)return[];const ids=tracks.map(t=>t.id).filter(Boolean);const featuresById=await _classPrivateFieldLooseBase(this,_fetchAudioFeatures)[_fetchAudioFeatures](ids);// Normalize to the shape your app already uses\nreturn tracks.map(t=>{var _featuresById$t$id$te,_featuresById$t$id,_t$duration_ms;return{id:t.id,name:t.name,artist:(t.artists||[]).map(a=>a.name).join(\", \"),bpm:(_featuresById$t$id$te=(_featuresById$t$id=featuresById[t.id])===null||_featuresById$t$id===void 0?void 0:_featuresById$t$id.tempo)!==null&&_featuresById$t$id$te!==void 0?_featuresById$t$id$te:null,durationMs:(_t$duration_ms=t.duration_ms)!==null&&_t$duration_ms!==void 0?_t$duration_ms:null};});}}async function _fetchAudioFeatures2(ids){// API allows up to 100 ids per request\nconst chunk=ids.slice(0,100);const data=await _classPrivateFieldLooseBase(this,_fetchJSON)[_fetchJSON](\"https://api.spotify.com/v1/audio-features?ids=\".concat(chunk.join(\",\")));const out={};for(const f of(_data$audio_features=data===null||data===void 0?void 0:data.audio_features)!==null&&_data$audio_features!==void 0?_data$audio_features:[]){var _data$audio_features,_f$tempo;if(f&&f.id)out[f.id]={tempo:(_f$tempo=f.tempo)!==null&&_f$tempo!==void 0?_f$tempo:null};}return out;}async function _fetchJSON2(url){const resp=await fetch(url,{headers:{Authorization:\"Bearer \".concat(_classPrivateFieldLooseBase(this,_token)[_token])}});if(!resp.ok){// Surface a friendly error (401 = expired/invalid token)\nconst msg=await resp.text();let friendlyMsg=msg;try{var _parsed$error;const parsed=JSON.parse(msg);if(parsed!==null&&parsed!==void 0&&(_parsed$error=parsed.error)!==null&&_parsed$error!==void 0&&_parsed$error.message){friendlyMsg=parsed.error.message;}}catch(_unused){// ignore JSON parse issues\n}throw new Error(\"Spotify \".concat(resp.status,\": \").concat(friendlyMsg||msg));}return resp.json();}","map":{"version":3,"names":["TrackProvider","_token","_classPrivateFieldLooseKey","_fetchAudioFeatures","_fetchJSON","SpotifyTrackProvider","constructor","token","Object","defineProperty","value","_fetchJSON2","_fetchAudioFeatures2","writable","_classPrivateFieldLooseBase","genreFromWorkout","workout","map","cardio","strength","yoga","hiit","warmup","cooldown","tempoWindowFromHR","hr","target","Math","max","min","round","getRecommendations","bpm","genre","params","URLSearchParams","limit","market","seed_genres","target_tempo","String","min_tempo","max_tempo","min_energy","min_danceability","rec","concat","toString","tracks","Array","isArray","length","ids","t","id","filter","Boolean","featuresById","_featuresById$t$id$te","_featuresById$t$id","_t$duration_ms","name","artist","artists","a","join","tempo","durationMs","duration_ms","chunk","slice","data","out","f","_data$audio_features","audio_features","_f$tempo","url","resp","fetch","headers","Authorization","ok","msg","text","friendlyMsg","_parsed$error","parsed","JSON","parse","error","message","_unused","Error","status","json"],"sources":["/Users/dawso/Desktop/beat-1/src/providers/SpotifyTrackProvider.js"],"sourcesContent":["import { TrackProvider } from \"./TrackProvider.js\";\n\n/**\n * Minimal Spotify Web API wrapper for Recommendations + Audio Features.\n * Works with a pasted OAuth token (no backend needed).\n */\nexport default class SpotifyTrackProvider extends TrackProvider {\n  #token;\n\n  constructor(token) {\n    super();\n    this.#token = token;\n  }\n\n  // Map your workout to seed genres (tweak to taste)\n  static genreFromWorkout(workout) {\n    const map = {\n      cardio: \"pop\",\n      strength: \"rock\",\n      yoga: \"ambient\",\n      hiit: \"edm\",\n      warmup: \"dance\",\n      cooldown: \"chill\"\n    };\n    return map[workout] || \"workout\";\n  }\n\n  static tempoWindowFromHR(hr) {\n    const target = Math.max(40, Math.min(220, Math.round(hr)));\n    const min = Math.max(40, target - 20);\n    const max = Math.min(220, target + 20);\n    return { min, target, max };\n  }\n\n  async getRecommendations(bpm, workout) {\n    const genre = SpotifyTrackProvider.genreFromWorkout(workout);\n    const { min, target, max } = SpotifyTrackProvider.tempoWindowFromHR(bpm);\n\n    // 1) /v1/recommendations\n    const params = new URLSearchParams({\n      limit: \"20\",\n      market: \"from_token\",\n      seed_genres: genre,\n      target_tempo: String(target),\n      min_tempo: String(min),\n      max_tempo: String(max),\n      min_energy: \"0.3\",\n      min_danceability: \"0.3\"\n    });\n\n    const rec = await this.#fetchJSON(\n      `https://api.spotify.com/v1/recommendations?${params.toString()}`\n    );\n\n    const tracks = Array.isArray(rec?.tracks) ? rec.tracks : [];\n    if (!tracks.length) return [];\n\n    const ids = tracks.map(t => t.id).filter(Boolean);\n    const featuresById = await this.#fetchAudioFeatures(ids);\n\n    // Normalize to the shape your app already uses\n    return tracks.map(t => ({\n      id: t.id,\n      name: t.name,\n      artist: (t.artists || []).map(a => a.name).join(\", \"),\n      bpm: featuresById[t.id]?.tempo ?? null,\n      durationMs: t.duration_ms ?? null\n    }));\n  }\n\n  async #fetchAudioFeatures(ids) {\n    // API allows up to 100 ids per request\n    const chunk = ids.slice(0, 100);\n    const data = await this.#fetchJSON(\n      `https://api.spotify.com/v1/audio-features?ids=${chunk.join(\",\")}`\n    );\n    const out = {};\n    for (const f of data?.audio_features ?? []) {\n      if (f && f.id) out[f.id] = { tempo: f.tempo ?? null };\n    }\n    return out;\n  }\n\n  async #fetchJSON(url) {\n    const resp = await fetch(url, {\n      headers: { Authorization: `Bearer ${this.#token}` }\n    });\n    if (!resp.ok) {\n      // Surface a friendly error (401 = expired/invalid token)\n      const msg = await resp.text();\n      let friendlyMsg = msg;\n      try {\n        const parsed = JSON.parse(msg);\n        if (parsed?.error?.message) {\n          friendlyMsg = parsed.error.message;\n        }\n      } catch {\n        // ignore JSON parse issues\n      }\n      throw new Error(`Spotify ${resp.status}: ${friendlyMsg || msg}`);\n    }\n    return resp.json();\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}