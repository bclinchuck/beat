{"ast":null,"code":"import _objectSpread from\"/Users/dawso/Desktop/beat-1/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{Heart,Music,Activity,Play,Pause,SkipForward,Settings,Mail,Lock,User,ArrowLeft,LogOut,Camera}from'lucide-react';import{createUserWithEmailAndPassword,signInWithEmailAndPassword,sendEmailVerification,signOut}from\"firebase/auth\";import{doc,getDoc,setDoc,collection,query,where,getDocs,updateDoc}from\"firebase/firestore\";import{auth,db,isFirebaseConfigured}from\"./firebase\";import SpotifyTrackProvider from\"./providers/SpotifyTrackProvider.js\";// ----------------------------------------------------------------------\n// SPOTIFY OAUTH CONSTANTS\n// ----------------------------------------------------------------------\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AUTH_STORAGE_KEY='beat_spotify_auth';const LOOPBACK_REDIRECT='http://127.0.0.1:3000/';const DEFAULT_REDIRECT=(()=>{if(process.env.REACT_APP_SPOTIFY_REDIRECT_URI){return process.env.REACT_APP_SPOTIFY_REDIRECT_URI;}if(typeof window==='undefined'){return LOOPBACK_REDIRECT;}const{protocol,port}=window.location;const normalizedPort=port?\":\".concat(port):':3000';return\"\".concat(protocol,\"//127.0.0.1\").concat(normalizedPort,\"/\");})();const SPOTIFY_CLIENT_ID=process.env.REACT_APP_SPOTIFY_CLIENT_ID||'70177f436adc418f98f6626d92667dde';const SPOTIFY_REDIRECT_URI=DEFAULT_REDIRECT;const SPOTIFY_SCOPES=['user-read-private','user-read-email'].join(' ');// ----------------------------------------------------------------------\n// Basic Email Regex for client-side validation\nconst EMAIL_REGEX=/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;// Utility function to format milliseconds into M:SS string\nconst DEFAULT_PROFILE_IMAGE='https://via.placeholder.com/150/9333ea/FFFFFF?text=P';const DEMO_USER_STORAGE_KEY='beat_demo_user';const DEMO_SESSION_KEY='beat_demo_session';const formatTime=ms=>{if(ms===null||isNaN(ms)||ms<0)return'0:00';const totalSeconds=Math.floor(ms/1000);const minutes=Math.floor(totalSeconds/60);const seconds=totalSeconds%60;return\"\".concat(minutes,\":\").concat(seconds.toString().padStart(2,'0'));};const formatBpm=bpm=>typeof bpm==='number'&&!Number.isNaN(bpm)&&bpm>0?\"\".concat(Math.round(bpm),\" BPM\"):'BPM n/a';const getDurationMs=song=>{if(!song||typeof song.durationMs!=='number'||song.durationMs<=0){return 210000;// fallback to 3.5 minutes if missing\n}return song.durationMs;};const loadStoredSpotifyAuth=()=>{if(typeof window==='undefined')return null;try{const raw=window.localStorage.getItem(AUTH_STORAGE_KEY);return raw?JSON.parse(raw):null;}catch(_unused){return null;}};const persistSpotifyAuth=payload=>{if(typeof window==='undefined')return;if(!payload){window.localStorage.removeItem(AUTH_STORAGE_KEY);return;}window.localStorage.setItem(AUTH_STORAGE_KEY,JSON.stringify(payload));};const loadDemoAuthUser=()=>{if(typeof window==='undefined')return null;try{const raw=window.localStorage.getItem(DEMO_USER_STORAGE_KEY);return raw?JSON.parse(raw):null;}catch(_unused2){return null;}};const persistDemoAuthUser=user=>{if(typeof window==='undefined')return;if(!user){window.localStorage.removeItem(DEMO_USER_STORAGE_KEY);return;}window.localStorage.setItem(DEMO_USER_STORAGE_KEY,JSON.stringify(user));};const loadDemoSessionFlag=()=>{if(typeof window==='undefined')return false;return window.localStorage.getItem(DEMO_SESSION_KEY)==='true';};const setDemoSessionFlag=value=>{if(typeof window==='undefined')return;if(!value){window.localStorage.removeItem(DEMO_SESSION_KEY);return;}window.localStorage.setItem(DEMO_SESSION_KEY,'true');};const createDefaultDemoUser=()=>({name:'Demo User',username:'demo',email:'demo@example.com',password:'demo123',profilePicture:DEFAULT_PROFILE_IMAGE});const generateRandomString=function(){let length=arguments.length>0&&arguments[0]!==undefined?arguments[0]:64;const possible='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let text='';for(let i=0;i<length;i+=1){text+=possible.charAt(Math.floor(Math.random()*possible.length));}return text;};const base64UrlEncode=arrayBuffer=>{let string='';const bytes=new Uint8Array(arrayBuffer);const len=bytes.byteLength;for(let i=0;i<len;i+=1){string+=String.fromCharCode(bytes[i]);}return btoa(string).replace(/\\+/g,'-').replace(/\\//g,'_').replace(/=+$/,'');};const createCodeChallenge=async verifier=>{var _window$crypto;if(typeof window==='undefined'||!((_window$crypto=window.crypto)!==null&&_window$crypto!==void 0&&_window$crypto.subtle)){throw new Error('Web Crypto API is not available.');}const encoder=new TextEncoder();const data=encoder.encode(verifier);const digest=await window.crypto.subtle.digest('SHA-256',data);return base64UrlEncode(digest);};export default function App(){const[heartRate,setHeartRate]=useState(72);const[isConnected,setIsConnected]=useState(false);const[isPlaying,setIsPlaying]=useState(false);const[currentSong,setCurrentSong]=useState(null);const[queue,setQueue]=useState([]);const[selectedWorkout,setSelectedWorkout]=useState('cardio');const[showSetup,setShowSetup]=useState(false);const[spotifyToken,setSpotifyToken]=useState(()=>{var _stored$accessToken;const stored=loadStoredSpotifyAuth();return(_stored$accessToken=stored===null||stored===void 0?void 0:stored.accessToken)!==null&&_stored$accessToken!==void 0?_stored$accessToken:null;});const[spotifyRefreshToken,setSpotifyRefreshToken]=useState(()=>{var _stored$refreshToken;const stored=loadStoredSpotifyAuth();return(_stored$refreshToken=stored===null||stored===void 0?void 0:stored.refreshToken)!==null&&_stored$refreshToken!==void 0?_stored$refreshToken:null;});const[spotifyTokenExpiresAt,setSpotifyTokenExpiresAt]=useState(()=>{var _stored$expiresAt;const stored=loadStoredSpotifyAuth();return(_stored$expiresAt=stored===null||stored===void 0?void 0:stored.expiresAt)!==null&&_stored$expiresAt!==void 0?_stored$expiresAt:null;});const[spotifyAuthInFlight,setSpotifyAuthInFlight]=useState(false);const[spotifyError,setSpotifyError]=useState(null);const[isFetchingTracks,setIsFetchingTracks]=useState(false);const[trackError,setTrackError]=useState(null);// State for music progress\nconst[currentPlaybackTime,setCurrentPlaybackTime]=useState(0);// in milliseconds\n// Authentication states\nconst[isAuthenticated,setIsAuthenticated]=useState(false);const[showLogin,setShowLogin]=useState(true);const[isSignUp,setIsSignUp]=useState(false);const[showForgotUsername,setShowForgotUsername]=useState(false);const[showForgotPassword,setShowForgotPassword]=useState(false);const[showEmailSent,setShowEmailSent]=useState(false);const[emailSentMessage,setEmailSentMessage]=useState('');// Profile and Settings\nconst[userProfile,setUserProfile]=useState(null);const[profilePictureUrl,setProfilePictureUrl]=useState(()=>{const storedDemoUser=loadDemoAuthUser();return(storedDemoUser===null||storedDemoUser===void 0?void 0:storedDemoUser.profilePicture)||DEFAULT_PROFILE_IMAGE;});const[showProfileSettings,setShowProfileSettings]=useState(false);// Form states\nconst[loginIdentifier,setLoginIdentifier]=useState('');const[loginPassword,setLoginPassword]=useState('');const[signupName,setSignupName]=useState('');const[signupUsername,setSignupUsername]=useState('');const[signupEmail,setSignupEmail]=useState('');const[signupPassword,setSignupPassword]=useState('');const[signupConfirmPassword,setSignupConfirmPassword]=useState('');const[forgotEmail,setForgotEmail]=useState('');const[forgotError,setForgotError]=useState('');const[signupError,setSignupError]=useState('');const[loginError,setLoginError]=useState('');const[profileUpdateSuccess,setProfileUpdateSuccess]=useState(false);const[demoUser,setDemoUser]=useState(()=>loadDemoAuthUser());const isDemoAuthMode=!isFirebaseConfigured;const[hasDemoSession,setHasDemoSession]=useState(()=>loadDemoSessionFlag());useEffect(()=>{if(!isDemoAuthMode)return;persistDemoAuthUser(demoUser);},[demoUser,isDemoAuthMode]);const ensureDemoUser=useCallback(()=>{if(demoUser)return demoUser;const defaultUser=createDefaultDemoUser();setDemoUser(defaultUser);return defaultUser;},[demoUser]);useEffect(()=>{if(!isDemoAuthMode)return;setDemoSessionFlag(hasDemoSession);},[hasDemoSession,isDemoAuthMode]);const disconnectSpotify=useCallback(()=>{setSpotifyToken(null);setSpotifyRefreshToken(null);setSpotifyTokenExpiresAt(null);setSpotifyError(null);setTrackError(null);},[]);const refreshSpotifyAccessToken=useCallback(async refreshToken=>{if(!refreshToken||!SPOTIFY_CLIENT_ID||SPOTIFY_CLIENT_ID.includes('YOUR_SPOTIFY_CLIENT_ID')){return null;}try{var _data$expires_in;const body=new URLSearchParams({client_id:SPOTIFY_CLIENT_ID,grant_type:'refresh_token',refresh_token:refreshToken});const response=await fetch('https://accounts.spotify.com/api/token',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:body.toString()});if(!response.ok){const message=await response.text();throw new Error(message||'Unable to refresh Spotify token.');}const data=await response.json();setSpotifyToken(data.access_token);setSpotifyTokenExpiresAt(Date.now()+((_data$expires_in=data.expires_in)!==null&&_data$expires_in!==void 0?_data$expires_in:3600)*1000);if(data.refresh_token){setSpotifyRefreshToken(data.refresh_token);}setSpotifyError(null);return data.access_token;}catch(error){setSpotifyError('Spotify session expired. Please reconnect.');disconnectSpotify();return null;}},[disconnectSpotify]);const exchangeSpotifyCodeForToken=useCallback(async authorizationCode=>{if(!SPOTIFY_CLIENT_ID||SPOTIFY_CLIENT_ID.includes('YOUR_SPOTIFY_CLIENT_ID')){setSpotifyError('Set REACT_APP_SPOTIFY_CLIENT_ID before connecting to Spotify.');return;}const verifier=sessionStorage.getItem('beat_spotify_code_verifier');if(!verifier){setSpotifyError('Missing PKCE verifier. Start the login again.');return;}setSpotifyAuthInFlight(true);try{var _data$expires_in2;const body=new URLSearchParams({client_id:SPOTIFY_CLIENT_ID,grant_type:'authorization_code',code:authorizationCode,redirect_uri:SPOTIFY_REDIRECT_URI,code_verifier:verifier});const response=await fetch('https://accounts.spotify.com/api/token',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:body.toString()});if(!response.ok){const message=await response.text();throw new Error(message||'Unable to complete Spotify sign-in.');}const data=await response.json();setSpotifyToken(data.access_token);setSpotifyTokenExpiresAt(Date.now()+((_data$expires_in2=data.expires_in)!==null&&_data$expires_in2!==void 0?_data$expires_in2:3600)*1000);if(data.refresh_token){setSpotifyRefreshToken(data.refresh_token);}setIsConnected(true);setShowSetup(false);setSpotifyError(null);}catch(error){setSpotifyError(error.message||'Unable to complete Spotify sign-in.');}finally{setSpotifyAuthInFlight(false);sessionStorage.removeItem('beat_spotify_code_verifier');sessionStorage.removeItem('beat_spotify_auth_state');}},[setIsConnected,setShowSetup]);useEffect(()=>{if(!spotifyToken){persistSpotifyAuth(null);return;}persistSpotifyAuth({accessToken:spotifyToken,refreshToken:spotifyRefreshToken,expiresAt:spotifyTokenExpiresAt});},[spotifyToken,spotifyRefreshToken,spotifyTokenExpiresAt]);useEffect(()=>{if(!spotifyToken||!spotifyTokenExpiresAt)return;const msUntilExpiry=spotifyTokenExpiresAt-Date.now();if(msUntilExpiry<=0){if(spotifyRefreshToken){refreshSpotifyAccessToken(spotifyRefreshToken);}else{disconnectSpotify();}return;}if(!spotifyRefreshToken)return;const timeoutId=setTimeout(()=>{refreshSpotifyAccessToken(spotifyRefreshToken);},Math.max(1000,msUntilExpiry-60000));// refresh one minute early\nreturn()=>clearTimeout(timeoutId);},[spotifyToken,spotifyTokenExpiresAt,spotifyRefreshToken,refreshSpotifyAccessToken,disconnectSpotify]);useEffect(()=>{if(typeof window==='undefined')return;const params=new URLSearchParams(window.location.search);const code=params.get('code');const authError=params.get('error');const stateParam=params.get('state');const storedState=sessionStorage.getItem('beat_spotify_auth_state');if(!code&&!authError)return;if(authError){setSpotifyError(\"Spotify authorization failed: \".concat(authError));setSpotifyAuthInFlight(false);}else if(code){if(storedState&&stateParam!==storedState){setSpotifyError('Spotify authorization state mismatch. Please try again.');sessionStorage.removeItem('beat_spotify_code_verifier');sessionStorage.removeItem('beat_spotify_auth_state');}else{exchangeSpotifyCodeForToken(code);}}params.delete('code');params.delete('state');params.delete('error');const newQuery=params.toString();const newUrl=\"\".concat(window.location.pathname).concat(newQuery?\"?\".concat(newQuery):'').concat(window.location.hash);window.history.replaceState({},document.title,newUrl);},[exchangeSpotifyCodeForToken]);const workoutTypes=[{id:'cardio',name:'Cardio',icon:'ðŸƒ',color:'bg-red-500',range:'120-160 BPM'},{id:'strength',name:'Strength Training',icon:'ðŸ’ª',color:'bg-blue-500',range:'90-120 BPM'},{id:'yoga',name:'Yoga/Stretching',icon:'ðŸ§˜',color:'bg-purple-500',range:'60-90 BPM'},{id:'hiit',name:'HIIT',icon:'ðŸ”¥',color:'bg-orange-500',range:'140-180 BPM'},{id:'warmup',name:'Warm Up',icon:'ðŸŒ…',color:'bg-yellow-500',range:'80-100 BPM'},{id:'cooldown',name:'Cool Down',icon:'â„ï¸',color:'bg-cyan-500',range:'60-80 BPM'}];// 1. Heart Rate Simulation (unchanged)\nuseEffect(()=>{if(!isConnected)return;const interval=setInterval(()=>{setHeartRate(prev=>{const change=Math.random()*10-5;const newRate=Math.max(50,Math.min(200,prev+change));return Math.round(newRate);});},2000);return()=>clearInterval(interval);},[isConnected]);// Mock Song Database - UPDATED with realistic durationMs\nconst getMockSongsForBPM=(bpm,workout)=>{const songs=[// Duration in MS: 3:48\n{id:1,name:'Electric Feel',artist:'MGMT',bpm:112,workout:'cardio',durationMs:228000},// Duration in MS: 4:30\n{id:2,name:'Uptown Funk',artist:'Bruno Mars',bpm:115,workout:'cardio',durationMs:270000},// Duration in MS: 4:07\n{id:3,name:'Stronger',artist:'Kanye West',bpm:104,workout:'strength',durationMs:247000},// Duration in MS: 4:05\n{id:4,name:'Eye of the Tiger',artist:'Survivor',bpm:109,workout:'strength',durationMs:245000},// Duration in MS: 4:26\n{id:5,name:'Breathe',artist:'Telepopmusik',bpm:72,workout:'yoga',durationMs:266000},// Duration in MS: 10:25 (Longer for yoga)\n{id:6,name:'Weightless',artist:'Marconi Union',bpm:60,workout:'yoga',durationMs:625000},// Duration in MS: 4:28\n{id:7,name:'Till I Collapse',artist:'Eminem',bpm:171,workout:'hiit',durationMs:268000},// Duration in MS: 4:52\n{id:8,name:'Thunderstruck',artist:'AC/DC',bpm:133,workout:'hiit',durationMs:292000},// Duration in MS: 4:29\n{id:9,name:'Cannot Stop',artist:'Red Hot Chili Peppers',bpm:118,workout:'cardio',durationMs:269000},// Duration in MS: 5:26\n{id:10,name:'Lose Yourself',artist:'Eminem',bpm:171,workout:'hiit',durationMs:326000},// Duration in MS: 3:39\n{id:11,name:'Work',artist:'Rihanna',bpm:92,workout:'strength',durationMs:219000},// Duration in MS: 2:41\n{id:12,name:'Sunflower',artist:'Post Malone',bpm:90,workout:'warmup',durationMs:161000},// Duration in MS: 3:23\n{id:13,name:'Levitating',artist:'Dua Lipa',bpm:103,workout:'cardio',durationMs:203000},// Duration in MS: 3:20\n{id:14,name:'Blinding Lights',artist:'The Weeknd',bpm:171,workout:'cardio',durationMs:200000},// Duration in MS: 3:36\n{id:15,name:'Do Not Stop Me Now',artist:'Queen',bpm:156,workout:'cardio',durationMs:216000},// Duration in MS: 3:38\n{id:16,name:'Shallow',artist:'Lady Gaga',bpm:96,workout:'warmup',durationMs:218000},// Duration in MS: 4:32\n{id:17,name:'Say Something',artist:'A Great Big World',bpm:72,workout:'yoga',durationMs:272000},// Duration in MS: 5:09\n{id:18,name:'The Scientist',artist:'Coldplay',bpm:73,workout:'cooldown',durationMs:309000},// Duration in MS: 4:55\n{id:19,name:'Fix You',artist:'Coldplay',bpm:68,workout:'cooldown',durationMs:295000},// Duration in MS: 3:21\n{id:20,name:'Skinny Love',artist:'Bon Iver',bpm:75,workout:'yoga',durationMs:201000},// Duration in MS: 4:05\n{id:21,name:'Gravity',artist:'John Mayer',bpm:70,workout:'cooldown',durationMs:245000},// Duration in MS: 6:53\n{id:22,name:'Hallelujah',artist:'Jeff Buckley',bpm:68,workout:'yoga',durationMs:413000},// Duration in MS: 3:05\n{id:23,name:'Mad World',artist:'Gary Jules',bpm:82,workout:'cooldown',durationMs:185000},// Duration in MS: 4:27\n{id:24,name:'Chasing Cars',artist:'Snow Patrol',bpm:76,workout:'cooldown',durationMs:267000},// Duration in MS: 3:13\n{id:25,name:'Physical',artist:'Dua Lipa',bpm:147,workout:'hiit',durationMs:193000},// Duration in MS: 3:45\n{id:26,name:'Higher Love',artist:'Kygo, Whitney Houston',bpm:104,workout:'cardio',durationMs:225000},// Duration in MS: 2:37\n{id:27,name:'Old Town Road',artist:'Lil Nas X',bpm:136,workout:'strength',durationMs:157000},// Duration in MS: 3:52\n{id:28,name:'Sweet Caroline',artist:'Neil Diamond',bpm:125,workout:'warmup',durationMs:232000},// Duration in MS: 3:55\n{id:29,name:'Strawberry Swing',artist:'Coldplay',bpm:90,workout:'yoga',durationMs:235000},// Duration in MS: 2:54\n{id:30,name:'One Dance',artist:'Drake',bpm:104,workout:'strength',durationMs:174000}];const workoutSongs=songs.filter(s=>s.workout===workout);// Filter songs that are within +/- 20 BPM of the current heart rate\nreturn workoutSongs.filter(song=>Math.abs(song.bpm-bpm)<=20).map(song=>_objectSpread(_objectSpread({},song),{},{bpmDiff:Math.abs(song.bpm-bpm)})).sort((a,b)=>a.bpmDiff-b.bpmDiff)// Sort by closest BPM match\n.slice(0,8);// Only show the top 8 matches\n};const skipSong=useCallback(()=>{setQueue(prevQueue=>{if(!currentSong)return prevQueue;const nextIndex=prevQueue.findIndex(s=>s.id===currentSong.id)+1;if(nextIndex<prevQueue.length){setCurrentSong(prevQueue[nextIndex]);return prevQueue;}else if(prevQueue.length>0){// Loop back to the first song if end of list is reached\nsetCurrentSong(prevQueue[0]);return prevQueue;}else{setCurrentSong(null);return prevQueue;}});},[currentSong]);// Reset playback time when a new song is set\nuseEffect(()=>{if(currentSong){setCurrentPlaybackTime(0);// Ensure player starts if a song is set\nif(!isPlaying){setIsPlaying(true);}}},[currentSong]);// Real-time Playback Timer and Auto-Skip\nuseEffect(()=>{// Only run if playing and a song is loaded\nif(!isPlaying||!currentSong){return;}const trackDuration=getDurationMs(currentSong);const interval=setInterval(()=>{setCurrentPlaybackTime(prev=>{const newTime=prev+1000;// Check if song is over\nif(newTime>=trackDuration){// Time is up, skip to next song\nskipSong();return 0;// The next useEffect handles the reset to 0 for the new song\n}return newTime;});},1000);return()=>clearInterval(interval);},[isPlaying,currentSong,skipSong]);// 2. LIVE QUEUEING MECHANISM (Triggers when heartRate changes)\nuseEffect(()=>{if(!isConnected){setQueue([]);setCurrentSong(null);setTrackError(null);setIsFetchingTracks(false);return;}if(!spotifyToken){const songsForBPM=getMockSongsForBPM(heartRate,selectedWorkout);if(songsForBPM.length===0){setQueue([]);setCurrentSong(null);setTrackError('No demo tracks found for this workout/BPM. Connect Spotify for live music.');return;}setTrackError(null);setIsFetchingTracks(false);setQueue(songsForBPM);setCurrentSong(prev=>{if(prev&&songsForBPM.some(song=>song.id===prev.id)){return prev;}if(isPlaying||!prev){return songsForBPM[0];}return prev;});return;}let cancelled=false;const provider=new SpotifyTrackProvider(spotifyToken);const fetchRecommendations=async()=>{setIsFetchingTracks(true);setTrackError(null);try{const tracks=await provider.getRecommendations(heartRate,selectedWorkout);if(cancelled)return;setQueue(tracks);setCurrentSong(prev=>{if(!tracks.length)return null;if(prev&&tracks.some(song=>song.id===prev.id)){return prev;}if(isPlaying||!prev){return tracks[0];}return prev;});}catch(error){var _error$message;if(cancelled)return;const friendly=error!==null&&error!==void 0&&(_error$message=error.message)!==null&&_error$message!==void 0&&_error$message.startsWith('Spotify 404')?'Spotify did not return any recommendations for this combo yet. Try another workout or reconnect.':(error===null||error===void 0?void 0:error.message)||'Unable to load Spotify recommendations.';setTrackError(friendly);setQueue([]);setCurrentSong(null);}finally{if(!cancelled){setIsFetchingTracks(false);}}};fetchRecommendations();return()=>{cancelled=true;};},[heartRate,selectedWorkout,isConnected,spotifyToken,isPlaying]);/**\n   * Handler to allow user to scrub/jump to a new position in the song.\n   * @param {React.MouseEvent<HTMLDivElement>} e The mouse event from clicking the progress bar.\n   */const handleScrub=e=>{if(!currentSong)return;// Get the element and its boundaries\nconst progressBar=e.currentTarget;const rect=progressBar.getBoundingClientRect();// Calculate the click position relative to the element's start\nconst clickX=e.clientX-rect.left;const width=rect.width;// Calculate the new time ratio and convert to milliseconds\nconst newTimeRatio=clickX/width;const newTimeMs=Math.floor(newTimeRatio*currentSong.durationMs);// Update playback time\nsetCurrentPlaybackTime(Math.max(0,Math.min(currentSong.durationMs,newTimeMs)));// Ensure playback restarts immediately if it was paused\nif(!isPlaying){setIsPlaying(true);}};// Authentication Handlers\nconst handleLogin=async e=>{e.preventDefault();setLoginError('');// Clear previous errors\nif(!loginIdentifier.trim()||!loginPassword.trim()){setLoginError('Please enter a username/email and password');return;}if(isDemoAuthMode){var _localUser$email,_localUser$username;const localUser=ensureDemoUser();const identifier=loginIdentifier.trim().toLowerCase();const matchesEmail=((_localUser$email=localUser.email)===null||_localUser$email===void 0?void 0:_localUser$email.toLowerCase())===identifier;const matchesUsername=((_localUser$username=localUser.username)===null||_localUser$username===void 0?void 0:_localUser$username.toLowerCase())===identifier;if(!matchesEmail&&!matchesUsername){setLoginError('Username or email not found.');return;}if(localUser.password!==loginPassword){setLoginError('Incorrect password. Please try again.');return;}setUserProfile({name:localUser.name,username:localUser.username,email:localUser.email,profilePicture:localUser.profilePicture});setProfilePictureUrl(localUser.profilePicture||DEFAULT_PROFILE_IMAGE);setIsAuthenticated(true);setIsConnected(true);setIsPlaying(true);setHasDemoSession(true);return;}try{let email=loginIdentifier;if(!loginIdentifier.includes('@')){const usersRef=collection(db,'users');const q=query(usersRef,where('username','==',loginIdentifier));const querySnapshot=await getDocs(q);if(querySnapshot.empty){setLoginError('Username not found');return;}email=querySnapshot.docs[0].data().email;}const userCred=await signInWithEmailAndPassword(auth,email,loginPassword);if(!userCred.user.emailVerified){await sendEmailVerification(userCred.user);setLoginError('Please verify your email before logging in. Verification email resent!');return;}const userDocRef=doc(db,'users',userCred.user.uid);let userData=null;try{var _userDocSnap$data;const userDocSnap=await getDoc(userDocRef);userData=userDocSnap!==null&&userDocSnap!==void 0&&userDocSnap.exists()&&typeof userDocSnap.data==='function'?(_userDocSnap$data=userDocSnap.data())!==null&&_userDocSnap$data!==void 0?_userDocSnap$data:null:null;}catch(docError){console.error('Error fetching user profile:',docError);}if(userData&&typeof userData==='object'){var _userData;setUserProfile(userData);setProfilePictureUrl(((_userData=userData)===null||_userData===void 0?void 0:_userData.profilePicture)||DEFAULT_PROFILE_IMAGE);}else{setUserProfile({email:userCred.user.email});setProfilePictureUrl(DEFAULT_PROFILE_IMAGE);}setIsAuthenticated(true);setIsConnected(true);setIsPlaying(true);}catch(error){if(error.code==='auth/too-many-requests'){setLoginError('Too many failed attempts. Please wait a few minutes before trying again.');}else if(error.code==='auth/user-not-found'){setLoginError('Username or email not found.');}else if(error.code==='auth/wrong-password'){setLoginError('Incorrect password. Please try again.');}else if(error.code==='auth/invalid-credential'){setLoginError('Incorrect password. Please try again.');}else{setLoginError(error.message);}}};const handleSignUp=async()=>{setSignupError(\"\");// clear previous errors\nif(!signupName.trim()||!signupUsername.trim()||!signupEmail.trim()||!signupPassword.trim()||!signupConfirmPassword.trim()){setSignupError(\"Please fill in all fields.\");return;}if(!EMAIL_REGEX.test(signupEmail)){setSignupError(\"Please enter a valid email address.\");return;}if(signupPassword!==signupConfirmPassword){setSignupError(\"Passwords do not match!\");return;}try{if(isDemoAuthMode){var _demoUser$email,_demoUser$username;const emailLower=signupEmail.toLowerCase();const usernameLower=signupUsername.toLowerCase();if(demoUser&&(((_demoUser$email=demoUser.email)===null||_demoUser$email===void 0?void 0:_demoUser$email.toLowerCase())===emailLower||((_demoUser$username=demoUser.username)===null||_demoUser$username===void 0?void 0:_demoUser$username.toLowerCase())===usernameLower)){setSignupError(\"An account already exists in local demo mode. Try logging in.\");return;}const newUser={name:signupName,username:signupUsername,email:signupEmail,password:signupPassword,profilePicture:DEFAULT_PROFILE_IMAGE};setDemoUser(newUser);setSignupError(\"Local account created! Sign in to continue.\");setSignupName(\"\");setSignupUsername(\"\");setSignupEmail(\"\");setSignupPassword(\"\");setSignupConfirmPassword(\"\");setIsSignUp(false);setShowLogin(true);return;}// âœ… Create account in Firebase Auth\nconst userCred=await createUserWithEmailAndPassword(auth,signupEmail,signupPassword);// âœ… Send verification email\nawait sendEmailVerification(userCred.user);// âŒ Don't log in yet\nawait signOut(auth);// make sure user is signed out until verified\n// âœ… Save username + name in Firestore\nawait setDoc(doc(db,\"users\",userCred.user.uid),{name:signupName,username:signupUsername,email:signupEmail});// âœ… Show in-app message instead of alert\nsetSignupError(\"Verification email sent! Please check your inbox before logging in.\");// Optionally, clear signup fields\nsetSignupName(\"\");setSignupUsername(\"\");setSignupEmail(\"\");setSignupPassword(\"\");setSignupConfirmPassword(\"\");}catch(error){setSignupError(error.message);// still shows errors in red box\n}};// Handlers for Forgot/Reset Flows (omitted for brevity, unchanged)\nconst handleForgotUsername=()=>{setForgotError('');if(!forgotEmail.trim()||!EMAIL_REGEX.test(forgotEmail)){setForgotError('Please enter a valid email address.');return;}setEmailSentMessage(\"An email with your username has been sent to \".concat(forgotEmail,\".\"));setShowEmailSent(true);setShowForgotUsername(false);};const handleForgotPassword=()=>{setForgotError('');if(!forgotEmail.trim()||!EMAIL_REGEX.test(forgotEmail)){setForgotError('Please enter a valid email address.');return;}setEmailSentMessage(\"A password reset link has been sent to \".concat(forgotEmail,\".\"));setShowEmailSent(true);setShowForgotPassword(false);};const handleLogout=()=>{disconnectSpotify();setIsAuthenticated(false);setUserProfile(null);setIsConnected(false);setShowSetup(false);setShowProfileSettings(false);setProfilePictureUrl(DEFAULT_PROFILE_IMAGE);setLoginIdentifier('');setLoginPassword('');setShowLogin(true);setIsSignUp(false);setShowEmailSent(false);setForgotEmail('');setForgotError('');setCurrentSong(null);setIsPlaying(false);setQueue([]);setCurrentPlaybackTime(0);setHasDemoSession(false);};const handleProfilePictureChange=async newUrl=>{const finalUrl=newUrl||DEFAULT_PROFILE_IMAGE;const completeUpdate=()=>{setProfilePictureUrl(finalUrl);setUserProfile(prev=>prev?_objectSpread(_objectSpread({},prev),{},{profilePicture:finalUrl}):prev);setProfileUpdateSuccess(true);setTimeout(()=>{setShowProfileSettings(false);setProfileUpdateSuccess(false);},2000);};if(isDemoAuthMode){setDemoUser(prev=>prev?_objectSpread(_objectSpread({},prev),{},{profilePicture:finalUrl}):prev);completeUpdate();return;}try{if(!(auth!==null&&auth!==void 0&&auth.currentUser)){console.error('No user logged in!');return;}const userRef=doc(db,'users',auth.currentUser.uid);await updateDoc(userRef,{profilePicture:finalUrl});completeUpdate();}catch(error){console.error('Error updating profile picture:',error.message);alert('Error saving profile picture: '+error.message);}};const initiateSpotifyAuth=useCallback(async()=>{var _window$crypto2;setSpotifyError(null);if(!SPOTIFY_CLIENT_ID||SPOTIFY_CLIENT_ID.includes('YOUR_SPOTIFY_CLIENT_ID')){setSpotifyError('Set REACT_APP_SPOTIFY_CLIENT_ID before connecting to Spotify.');return;}if(typeof window==='undefined'||!((_window$crypto2=window.crypto)!==null&&_window$crypto2!==void 0&&_window$crypto2.subtle)){setSpotifyError('This device does not support the Web Crypto APIs required for Spotify login.');return;}try{setSpotifyAuthInFlight(true);const verifier=generateRandomString(64);const challenge=await createCodeChallenge(verifier);const state=generateRandomString(16);sessionStorage.setItem('beat_spotify_code_verifier',verifier);sessionStorage.setItem('beat_spotify_auth_state',state);const params=new URLSearchParams({response_type:'code',client_id:SPOTIFY_CLIENT_ID,redirect_uri:SPOTIFY_REDIRECT_URI,scope:SPOTIFY_SCOPES,code_challenge_method:'S256',code_challenge:challenge,state});window.location.assign(\"https://accounts.spotify.com/authorize?\".concat(params.toString()));}catch(error){console.error('Spotify auth error:',error);setSpotifyAuthInFlight(false);setSpotifyError((error===null||error===void 0?void 0:error.message)||'Unable to start Spotify authorization.');}},[]);// Legacy helper (kept for backward compatibility)\nconst handleProfilePictureSave=async()=>{handleProfilePictureChange(profilePictureUrl);};const continueInDemoMode=()=>{if(!isDemoAuthMode)return;const user=ensureDemoUser();setUserProfile({name:user.name,username:user.username,email:user.email,profilePicture:user.profilePicture});setProfilePictureUrl(user.profilePicture||DEFAULT_PROFILE_IMAGE);setIsAuthenticated(true);setIsConnected(true);setIsPlaying(true);setShowLogin(false);setIsSignUp(false);setShowForgotUsername(false);setShowForgotPassword(false);setShowEmailSent(false);setLoginError('');setSignupError('');setHasDemoSession(true);};const togglePlayback=()=>{const newPlayingState=!isPlaying;setIsPlaying(newPlayingState);// If starting playback and no song is loaded, load the first queue song\nif(newPlayingState&&!currentSong&&queue.length>0){setCurrentSong(queue[0]);}};const getHeartRateColor=hr=>{if(hr<100)return'text-green-500';if(hr<140)return'text-yellow-500';if(hr<170)return'text-orange-500';return'text-red-500';};// Profile Settings Modal Component (omitted for brevity, unchanged)\nconst ProfileSettingsModal=()=>{const[tempUrl,setTempUrl]=useState(profilePictureUrl||'');useEffect(()=>{if(showProfileSettings){setTempUrl(profilePictureUrl||'');}},[showProfileSettings]);const handleSave=()=>{handleProfilePictureChange(tempUrl);};return/*#__PURE__*/_jsxs(\"div\",{className:\"fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4\",children:[profileUpdateSuccess&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in-out\",children:\"Profile picture updated successfully!\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-md w-full border border-gray-700\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-white mb-6\",children:\"Profile Settings\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col items-center mb-6\",children:/*#__PURE__*/_jsx(\"img\",{src:tempUrl||DEFAULT_PROFILE_IMAGE,alt:\"Profile\",className:\"w-24 h-24 rounded-full object-cover mb-4 border-4 border-purple-500 shadow-xl\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:tempUrl,onChange:e=>setTempUrl(e.target.value),placeholder:\"Enter new image URL\",className:\"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,className:\"w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition-all\",children:\"Save Picture\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowProfileSettings(false);setProfileUpdateSuccess(false);},className:\"w-full bg-gray-700 text-gray-300 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-all\",children:\"Close\"})]})]})]});};if(showProfileSettings){return/*#__PURE__*/_jsx(ProfileSettingsModal,{});}useEffect(()=>{if(!isDemoAuthMode||isAuthenticated||!hasDemoSession)return;continueInDemoMode();},[isDemoAuthMode,isAuthenticated,hasDemoSession]);// --- Authentication UI ---\nif(!isAuthenticated){// ... [Authentication UI Code Here - Unchanged from previous step] ...\nreturn/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-4 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md w-full\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 rounded-2xl shadow-2xl p-8 border border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center mb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-4 rounded-2xl shadow-lg\",children:/*#__PURE__*/_jsx(Heart,{className:\"w-12 h-12 text-red-500\",fill:\"currentColor\"})})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-white mb-2\",children:\"Beat\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400\",children:\"Your music, synced to your heartbeat\"})]}),showForgotUsername&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-white mb-6\",children:\"Recover Username\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 mb-4\",children:\"Enter your email address and we'll send you your username.\"}),forgotError&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-900/50 border border-red-500 text-red-300 p-3 rounded-lg mb-4 text-sm\",children:forgotError}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-300 mb-2\",children:\"Email\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(Mail,{className:\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:forgotEmail,onChange:e=>{setForgotEmail(e.target.value);setForgotError('');},placeholder:\"your@email.com\",className:\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleForgotUsername,className:\"w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition-all\",children:\"Send Username\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 text-center\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{setShowForgotUsername(false);setShowLogin(true);setForgotEmail('');setForgotError('');},className:\"text-purple-400 hover:text-purple-300 font-semibold transition-colors\",children:[/*#__PURE__*/_jsx(ArrowLeft,{className:\"w-4 h-4 inline-block mr-2\"}),\" Back to Sign In\"]})})]}),showForgotPassword&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-white mb-6\",children:\"Reset Password\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 mb-4\",children:\"Enter your email address and we'll send you a reset link.\"}),forgotError&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-900/50 border border-red-500 text-red-300 p-3 rounded-lg mb-4 text-sm\",children:forgotError}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-300 mb-2\",children:\"Email\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(Mail,{className:\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:forgotEmail,onChange:e=>{setForgotEmail(e.target.value);setForgotError('');},placeholder:\"your@email.com\",className:\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleForgotPassword,className:\"w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition-all\",children:\"Send Reset Link\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 text-center\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{setShowForgotPassword(false);setShowLogin(true);setForgotEmail('');setForgotError('');},className:\"text-purple-400 hover:text-purple-300 font-semibold transition-colors\",children:[/*#__PURE__*/_jsx(ArrowLeft,{className:\"w-4 h-4 inline-block mr-2\"}),\" Back to Sign In\"]})})]}),showEmailSent&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center p-4\",children:[/*#__PURE__*/_jsx(Mail,{className:\"w-12 h-12 text-green-500 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-white mb-4\",children:\"Success!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 mb-6\",children:emailSentMessage}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowEmailSent(false);setShowLogin(true);setForgotEmail('');setForgotError('');},className:\"w-full bg-purple-500 text-white py-3 rounded-lg font-semibold hover:bg-purple-600 transition-all\",children:\"OK\"})]}),showLogin&&!isSignUp&&!showForgotUsername&&!showForgotPassword&&!showEmailSent&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-white mb-6\",children:\"Sign In\"}),isDemoAuthMode&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-900/40 border border-blue-500 text-blue-100 p-3 rounded-lg mb-4 text-sm\",children:\"Local demo auth mode is active. Accounts you create here live only in this browser.\"}),loginError&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-900/50 border border-red-500 text-red-300 p-3 rounded-lg mb-4 text-sm\",children:loginError}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-300 mb-2\",children:\"Email or Username\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(Mail,{className:\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:loginIdentifier,onChange:e=>setLoginIdentifier(e.target.value),placeholder:\"username or your@email.com\",className:\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-300 mb-2\",children:\"Password\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(Lock,{className:\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:loginPassword,onChange:e=>setLoginPassword(e.target.value),placeholder:\"\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\",className:\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between text-sm\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{setShowForgotUsername(true);setShowLogin(false);},className:\"text-purple-400 hover:text-purple-300 transition-colors\",children:\"Forgot username?\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{setShowForgotPassword(true);setShowLogin(false);},className:\"text-purple-400 hover:text-purple-300 transition-colors\",children:\"Forgot password?\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogin,className:\"w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition-all\",children:\"Sign In\"}),isDemoAuthMode&&/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:continueInDemoMode,className:\"w-full mt-3 bg-gray-700 text-gray-200 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-all\",children:\"Continue as guest (demo mode)\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 text-center\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-400\",children:[\"Don't have an account?\",' ',/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsSignUp(true),className:\"text-purple-400 hover:text-purple-300 font-semibold transition-colors\",children:\"Sign Up\"})]})})]}),isSignUp&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-white mb-6\",children:\"Create Account\"}),isDemoAuthMode&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-900/40 border border-blue-500 text-blue-100 p-3 rounded-lg mb-4 text-sm\",children:\"This account lives only in your browser while Firebase is disconnected.\"}),signupError&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-900/50 border border-red-500 text-red-300 p-3 rounded-lg mb-4 text-sm\",children:signupError}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-300 mb-2\",children:\"Full Name\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(User,{className:\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:signupName,onChange:e=>setSignupName(e.target.value),placeholder:\"John Doe\",className:\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-300 mb-2\",children:\"Username\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(User,{className:\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:signupUsername,onChange:e=>setSignupUsername(e.target.value),placeholder:\"mybeatname\",className:\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-300 mb-2\",children:\"Email\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(Mail,{className:\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:signupEmail,onChange:e=>setSignupEmail(e.target.value),placeholder:\"your@email.com\",className:\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-300 mb-2\",children:\"Password\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(Lock,{className:\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:signupPassword,onChange:e=>setSignupPassword(e.target.value),placeholder:\"\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\",className:\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-300 mb-2\",children:\"Confirm Password\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(Lock,{className:\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:signupConfirmPassword,onChange:e=>setSignupConfirmPassword(e.target.value),placeholder:\"\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\",className:\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSignUp,className:\"w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all\",children:\"Create Account\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 text-center\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-400\",children:[\"Already have an account?\",' ',/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsSignUp(false),className:\"text-purple-400 hover:text-purple-300 font-semibold transition-colors\",children:\"Sign In\"})]})})]})]})})});}// --- SPOTIFY SETUP UI (omitted for brevity, unchanged) ---\nif(showSetup){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-2xl mx-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 rounded-2xl shadow-2xl p-8 border border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center mb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-4 rounded-2xl shadow-lg\",children:/*#__PURE__*/_jsx(Heart,{className:\"w-12 h-12 text-red-500\",fill:\"currentColor\"})})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-white mb-2\",children:\"Beat Setup\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400\",children:\"Connect your Spotify account to sync your music\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[spotifyError&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-900/40 border border-red-700 text-red-100 rounded-lg p-4 text-sm\",children:spotifyError}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-700 rounded-lg p-6 text-center space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold text-white mb-2\",children:\"Authorize Spotify\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400\",children:\"We use Spotify's browser-based PKCE flow, so it works on Firebase Hosting without a custom backend.\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:initiateSpotifyAuth,disabled:spotifyAuthInFlight,className:\"w-full py-3 rounded-lg font-semibold transition-all \".concat(spotifyAuthInFlight?'bg-gray-600 text-gray-300 cursor-not-allowed':'bg-gradient-to-r from-green-500 to-green-600 text-white hover:from-green-600 hover:to-green-700'),children:spotifyAuthInFlight?'Opening Spotifyâ€¦':'Connect with Spotify'}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-400\",children:[\"Make sure\",' ',/*#__PURE__*/_jsx(\"span\",{className:\"text-white font-mono\",children:SPOTIFY_REDIRECT_URI}),' ',\"is added as a Redirect URI in your Spotify Developer Dashboard.\"]})]}),spotifyToken&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-900/30 border border-green-600 rounded-lg p-6 text-center space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold text-white\",children:\"Spotify Connected\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-green-100 text-sm\",children:\"Your Firebase-hosted app is linked to Spotify. Close this dialog to start syncing live tracks.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col md:flex-row gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowSetup(false),className:\"flex-1 bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-500 transition-colors\",children:\"Back to Dashboard\"}),/*#__PURE__*/_jsx(\"button\",{onClick:disconnectSpotify,className:\"flex-1 bg-gray-800 border border-gray-600 text-gray-100 py-2 rounded-lg font-semibold hover:bg-gray-700 transition-colors\",children:\"Disconnect Spotify\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-full border-t border-gray-700\"}),/*#__PURE__*/_jsx(\"span\",{className:\"px-3 text-gray-500 text-sm\",children:\"OR\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full border-t border-gray-700\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{disconnectSpotify();setIsConnected(true);setShowSetup(false);setIsPlaying(true);},className:\"w-full bg-gray-700 text-gray-300 py-3 rounded-lg text-lg hover:bg-gray-600 transition-all\",children:\"Continue without Spotify (Demo Mode)\"})]})]})})});}// MAIN APPLICATION UI\nreturn/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-4 md:p-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-white rounded-xl flex items-center justify-center mr-3 shadow-lg\",children:/*#__PURE__*/_jsx(Heart,{className:\"w-8 h-8 text-red-500\",fill:\"currentColor\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-white\",children:\"Beat\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-sm\",children:spotifyToken?'Spotify live mode Â· playlists refresh with your BPM':'Demo mode Â· connect Spotify to stream real recommendations'})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 rounded-xl p-3 flex items-center space-x-3 border border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-10 h-10 rounded-full overflow-hidden cursor-pointer group relative\",onClick:()=>setShowProfileSettings(true),children:[/*#__PURE__*/_jsx(\"img\",{src:profilePictureUrl,alt:\"Profile\",className:\"w-full h-full object-cover\"}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\",children:/*#__PURE__*/_jsx(Camera,{className:\"w-5 h-5 text-white\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"hidden md:block\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-white font-semibold text-sm\",children:userProfile===null||userProfile===void 0?void 0:userProfile.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-400 text-xs\",children:[\"@\",userProfile===null||userProfile===void 0?void 0:userProfile.username]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,className:\"ml-2 px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-sm rounded-lg transition-colors\",children:/*#__PURE__*/_jsx(LogOut,{className:\"w-4 h-4\"})})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid md:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"md:col-span-2 bg-gray-800 rounded-2xl shadow-2xl p-6 border border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white mb-1\",children:\"Current Heart Rate\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-sm\",children:\"Live monitoring active\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowSetup(true),className:\"p-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors\",children:/*#__PURE__*/_jsx(Settings,{className:\"w-5 h-5 text-gray-300\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 bg-gradient-to-r from-red-500 to-pink-500 rounded-full blur-xl opacity-50\"}),/*#__PURE__*/_jsx(\"div\",{className:\"relative bg-gray-900 rounded-full p-8\",children:/*#__PURE__*/_jsx(Heart,{className:\"w-16 h-16 \".concat(getHeartRateColor(heartRate),\" animate-pulse\")})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-6xl font-bold \".concat(getHeartRateColor(heartRate)),children:heartRate}),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 text-xl\",children:\"BPM\"})]})]}),currentSong?/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-br from-gray-700 to-gray-800 rounded-xl p-6 mb-6 border border-gray-600\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-24 h-24 bg-gradient-to-br from-red-500 to-pink-500 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0\",children:/*#__PURE__*/_jsx(Music,{className:\"w-12 h-12 text-white\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-xs uppercase tracking-wide mb-1\",children:\"Now Playing\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-white font-bold text-2xl mb-1 truncate\",children:currentSong.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-300 text-lg truncate mb-2\",children:currentSong.artist}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-3\",children:/*#__PURE__*/_jsx(\"span\",{className:\"bg-green-500/20 text-green-400 text-sm font-semibold px-3 py-1 rounded-full\",children:formatBpm(currentSong.bpm)})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:togglePlayback,className:\"bg-green-500 hover:bg-green-600 text-white p-4 rounded-full transition-colors shadow-lg\",children:isPlaying?/*#__PURE__*/_jsx(Pause,{className:\"w-6 h-6\"}):/*#__PURE__*/_jsx(Play,{className:\"w-6 h-6 ml-0.5\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:skipSong,className:\"bg-gray-600 hover:bg-gray-500 text-white p-4 rounded-full transition-colors\",children:/*#__PURE__*/_jsx(SkipForward,{className:\"w-6 h-6\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400 text-sm\",children:formatTime(currentPlaybackTime)}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 bg-gray-600 h-2 rounded-full overflow-hidden cursor-pointer group\",onClick:handleScrub,children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-500 h-full transition-none\",style:{width:\"\".concat(Math.min(100,currentPlaybackTime/getDurationMs(currentSong)*100),\"%\"),// Add a subtle hover effect for better scrubbing feel\nboxShadow:'0 0 10px rgba(16, 185, 129, 0.5)'}})}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400 text-sm\",children:formatTime(currentSong.durationMs)})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-700 rounded-xl p-6 mb-6 text-center text-gray-400 border border-gray-600\",children:[/*#__PURE__*/_jsx(Music,{className:\"w-8 h-8 mx-auto mb-2\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold\",children:\"No Song Loaded\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:\"Change your Workout Type or check your connection status.\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-white font-semibold mb-3 flex items-center\",children:[/*#__PURE__*/_jsx(Activity,{className:\"w-5 h-5 mr-2\"}),\"Queue (Matched to Your BPM)\"]}),spotifyToken?/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-green-300 mb-3\",children:\"Live Spotify recommendations updating with your heart rate.\"}):/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-yellow-300 mb-3\",children:\"Using demo tracks. Connect Spotify for real music.\"}),isFetchingTracks&&spotifyToken&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-900/20 border border-green-700 text-green-100 text-sm rounded-lg p-3 mb-3\",children:\"Syncing with Spotify\\u2026\"}),trackError&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-900/30 border border-red-700 text-red-100 text-sm rounded-lg p-3 mb-3\",children:trackError}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2 max-h-64 overflow-y-auto\",children:queue.map((song,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"rounded-lg p-3 flex items-center justify-between transition-all \".concat((currentSong===null||currentSong===void 0?void 0:currentSong.id)===song.id?'bg-green-600 shadow-lg':'bg-gray-700'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3 flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center w-8\",children:(currentSong===null||currentSong===void 0?void 0:currentSong.id)===song.id?/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-0.5\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-1 bg-white h-4 animate-pulse\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-1 bg-white h-3 animate-pulse\",style:{animationDelay:'0.2s'}}),/*#__PURE__*/_jsx(\"div\",{className:\"w-1 bg-white h-5 animate-pulse\",style:{animationDelay:'0.4s'}})]}):/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400 text-sm\",children:idx+1})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium truncate text-white\",children:song.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs truncate \".concat((currentSong===null||currentSong===void 0?void 0:currentSong.id)===song.id?'text-green-100':'text-gray-400'),children:song.artist})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-semibold \".concat((currentSong===null||currentSong===void 0?void 0:currentSong.id)===song.id?'text-white':'text-green-400'),children:formatBpm(song.bpm)}),(currentSong===null||currentSong===void 0?void 0:currentSong.id)===song.id&&/*#__PURE__*/_jsx(Music,{className:\"w-4 h-4 text-white animate-pulse\"})]})]},song.id))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 rounded-2xl shadow-2xl p-6 border border-gray-700\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-white mb-4\",children:\"Workout Type\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3\",children:workoutTypes.map(workout=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedWorkout(workout.id),className:\"w-full p-4 rounded-xl transition-all \".concat(selectedWorkout===workout.id?\"\".concat(workout.color,\" text-white shadow-lg scale-105\"):'bg-gray-700 text-gray-300 hover:bg-gray-600'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-2xl\",children:workout.icon}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-left flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold\",children:workout.name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs \".concat(selectedWorkout===workout.id?'text-white/80':'text-gray-400'),children:workout.range})]})]})},workout.id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 bg-gray-700 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-white font-semibold mb-2 text-sm\",children:\"How it works\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 text-xs leading-relaxed\",children:\"As your heart rate changes during your workout, the app automatically queues songs that match your current BPM, keeping you in the zone.\"})]})]})]})]})});}","map":{"version":3,"names":["React","useState","useEffect","useCallback","Heart","Music","Activity","Play","Pause","SkipForward","Settings","Mail","Lock","User","ArrowLeft","LogOut","Camera","createUserWithEmailAndPassword","signInWithEmailAndPassword","sendEmailVerification","signOut","doc","getDoc","setDoc","collection","query","where","getDocs","updateDoc","auth","db","isFirebaseConfigured","SpotifyTrackProvider","jsx","_jsx","jsxs","_jsxs","AUTH_STORAGE_KEY","LOOPBACK_REDIRECT","DEFAULT_REDIRECT","process","env","REACT_APP_SPOTIFY_REDIRECT_URI","window","protocol","port","location","normalizedPort","concat","SPOTIFY_CLIENT_ID","REACT_APP_SPOTIFY_CLIENT_ID","SPOTIFY_REDIRECT_URI","SPOTIFY_SCOPES","join","EMAIL_REGEX","DEFAULT_PROFILE_IMAGE","DEMO_USER_STORAGE_KEY","DEMO_SESSION_KEY","formatTime","ms","isNaN","totalSeconds","Math","floor","minutes","seconds","toString","padStart","formatBpm","bpm","Number","round","getDurationMs","song","durationMs","loadStoredSpotifyAuth","raw","localStorage","getItem","JSON","parse","_unused","persistSpotifyAuth","payload","removeItem","setItem","stringify","loadDemoAuthUser","_unused2","persistDemoAuthUser","user","loadDemoSessionFlag","setDemoSessionFlag","value","createDefaultDemoUser","name","username","email","password","profilePicture","generateRandomString","length","arguments","undefined","possible","text","i","charAt","random","base64UrlEncode","arrayBuffer","string","bytes","Uint8Array","len","byteLength","String","fromCharCode","btoa","replace","createCodeChallenge","verifier","_window$crypto","crypto","subtle","Error","encoder","TextEncoder","data","encode","digest","App","heartRate","setHeartRate","isConnected","setIsConnected","isPlaying","setIsPlaying","currentSong","setCurrentSong","queue","setQueue","selectedWorkout","setSelectedWorkout","showSetup","setShowSetup","spotifyToken","setSpotifyToken","_stored$accessToken","stored","accessToken","spotifyRefreshToken","setSpotifyRefreshToken","_stored$refreshToken","refreshToken","spotifyTokenExpiresAt","setSpotifyTokenExpiresAt","_stored$expiresAt","expiresAt","spotifyAuthInFlight","setSpotifyAuthInFlight","spotifyError","setSpotifyError","isFetchingTracks","setIsFetchingTracks","trackError","setTrackError","currentPlaybackTime","setCurrentPlaybackTime","isAuthenticated","setIsAuthenticated","showLogin","setShowLogin","isSignUp","setIsSignUp","showForgotUsername","setShowForgotUsername","showForgotPassword","setShowForgotPassword","showEmailSent","setShowEmailSent","emailSentMessage","setEmailSentMessage","userProfile","setUserProfile","profilePictureUrl","setProfilePictureUrl","storedDemoUser","showProfileSettings","setShowProfileSettings","loginIdentifier","setLoginIdentifier","loginPassword","setLoginPassword","signupName","setSignupName","signupUsername","setSignupUsername","signupEmail","setSignupEmail","signupPassword","setSignupPassword","signupConfirmPassword","setSignupConfirmPassword","forgotEmail","setForgotEmail","forgotError","setForgotError","signupError","setSignupError","loginError","setLoginError","profileUpdateSuccess","setProfileUpdateSuccess","demoUser","setDemoUser","isDemoAuthMode","hasDemoSession","setHasDemoSession","ensureDemoUser","defaultUser","disconnectSpotify","refreshSpotifyAccessToken","includes","_data$expires_in","body","URLSearchParams","client_id","grant_type","refresh_token","response","fetch","method","headers","ok","message","json","access_token","Date","now","expires_in","error","exchangeSpotifyCodeForToken","authorizationCode","sessionStorage","_data$expires_in2","code","redirect_uri","code_verifier","msUntilExpiry","timeoutId","setTimeout","max","clearTimeout","params","search","get","authError","stateParam","storedState","delete","newQuery","newUrl","pathname","hash","history","replaceState","document","title","workoutTypes","id","icon","color","range","interval","setInterval","prev","change","newRate","min","clearInterval","getMockSongsForBPM","workout","songs","artist","workoutSongs","filter","s","abs","map","_objectSpread","bpmDiff","sort","a","b","slice","skipSong","prevQueue","nextIndex","findIndex","trackDuration","newTime","songsForBPM","some","cancelled","provider","fetchRecommendations","tracks","getRecommendations","_error$message","friendly","startsWith","handleScrub","e","progressBar","currentTarget","rect","getBoundingClientRect","clickX","clientX","left","width","newTimeRatio","newTimeMs","handleLogin","preventDefault","trim","_localUser$email","_localUser$username","localUser","identifier","toLowerCase","matchesEmail","matchesUsername","usersRef","q","querySnapshot","empty","docs","userCred","emailVerified","userDocRef","uid","userData","_userDocSnap$data","userDocSnap","exists","docError","console","_userData","handleSignUp","test","_demoUser$email","_demoUser$username","emailLower","usernameLower","newUser","handleForgotUsername","handleForgotPassword","handleLogout","handleProfilePictureChange","finalUrl","completeUpdate","currentUser","userRef","alert","initiateSpotifyAuth","_window$crypto2","challenge","state","response_type","scope","code_challenge_method","code_challenge","assign","handleProfilePictureSave","continueInDemoMode","togglePlayback","newPlayingState","getHeartRateColor","hr","ProfileSettingsModal","tempUrl","setTempUrl","handleSave","className","children","src","alt","type","onChange","target","placeholder","onClick","fill","disabled","style","boxShadow","idx","animationDelay"],"sources":["/Users/dawso/Desktop/beat-1/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport {\n  Heart,\n  Music,\n  Activity,\n  Play,\n  Pause,\n  SkipForward,\n  Settings,\n  Mail,\n  Lock,\n  User,\n  ArrowLeft,\n  LogOut,\n  Camera,\n} from 'lucide-react';\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, signOut } from \"firebase/auth\";\nimport { doc, getDoc, setDoc, collection, query, where, getDocs, updateDoc } from \"firebase/firestore\";\nimport { auth, db, isFirebaseConfigured } from \"./firebase\";\nimport SpotifyTrackProvider from \"./providers/SpotifyTrackProvider.js\";\n\n// ----------------------------------------------------------------------\n// SPOTIFY OAUTH CONSTANTS\n// ----------------------------------------------------------------------\nconst AUTH_STORAGE_KEY = 'beat_spotify_auth';\nconst LOOPBACK_REDIRECT = 'http://127.0.0.1:3000/';\nconst DEFAULT_REDIRECT = (() => {\n  if (process.env.REACT_APP_SPOTIFY_REDIRECT_URI) {\n    return process.env.REACT_APP_SPOTIFY_REDIRECT_URI;\n  }\n  if (typeof window === 'undefined') {\n    return LOOPBACK_REDIRECT;\n  }\n  const { protocol, port } = window.location;\n  const normalizedPort = port ? `:${port}` : ':3000';\n  return `${protocol}//127.0.0.1${normalizedPort}/`;\n})();\nconst SPOTIFY_CLIENT_ID =\n  process.env.REACT_APP_SPOTIFY_CLIENT_ID || '70177f436adc418f98f6626d92667dde';\nconst SPOTIFY_REDIRECT_URI = DEFAULT_REDIRECT;\nconst SPOTIFY_SCOPES = [\n  'user-read-private',\n  'user-read-email',\n].join(' ');\n// ----------------------------------------------------------------------\n\n// Basic Email Regex for client-side validation\nconst EMAIL_REGEX = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\n// Utility function to format milliseconds into M:SS string\nconst DEFAULT_PROFILE_IMAGE =\n  'https://via.placeholder.com/150/9333ea/FFFFFF?text=P';\nconst DEMO_USER_STORAGE_KEY = 'beat_demo_user';\nconst DEMO_SESSION_KEY = 'beat_demo_session';\n\nconst formatTime = (ms) => {\n  if (ms === null || isNaN(ms) || ms < 0) return '0:00';\n  const totalSeconds = Math.floor(ms / 1000);\n  const minutes = Math.floor(totalSeconds / 60);\n  const seconds = totalSeconds % 60;\n  return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n};\n\nconst formatBpm = (bpm) =>\n  typeof bpm === 'number' && !Number.isNaN(bpm) && bpm > 0\n    ? `${Math.round(bpm)} BPM`\n    : 'BPM n/a';\n\nconst getDurationMs = (song) => {\n  if (!song || typeof song.durationMs !== 'number' || song.durationMs <= 0) {\n    return 210000; // fallback to 3.5 minutes if missing\n  }\n  return song.durationMs;\n};\n\nconst loadStoredSpotifyAuth = () => {\n  if (typeof window === 'undefined') return null;\n  try {\n    const raw = window.localStorage.getItem(AUTH_STORAGE_KEY);\n    return raw ? JSON.parse(raw) : null;\n  } catch {\n    return null;\n  }\n};\n\nconst persistSpotifyAuth = (payload) => {\n  if (typeof window === 'undefined') return;\n  if (!payload) {\n    window.localStorage.removeItem(AUTH_STORAGE_KEY);\n    return;\n  }\n  window.localStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(payload));\n};\n\nconst loadDemoAuthUser = () => {\n  if (typeof window === 'undefined') return null;\n  try {\n    const raw = window.localStorage.getItem(DEMO_USER_STORAGE_KEY);\n    return raw ? JSON.parse(raw) : null;\n  } catch {\n    return null;\n  }\n};\n\nconst persistDemoAuthUser = (user) => {\n  if (typeof window === 'undefined') return;\n  if (!user) {\n    window.localStorage.removeItem(DEMO_USER_STORAGE_KEY);\n    return;\n  }\n  window.localStorage.setItem(DEMO_USER_STORAGE_KEY, JSON.stringify(user));\n};\n\nconst loadDemoSessionFlag = () => {\n  if (typeof window === 'undefined') return false;\n  return window.localStorage.getItem(DEMO_SESSION_KEY) === 'true';\n};\n\nconst setDemoSessionFlag = (value) => {\n  if (typeof window === 'undefined') return;\n  if (!value) {\n    window.localStorage.removeItem(DEMO_SESSION_KEY);\n    return;\n  }\n  window.localStorage.setItem(DEMO_SESSION_KEY, 'true');\n};\n\nconst createDefaultDemoUser = () => ({\n  name: 'Demo User',\n  username: 'demo',\n  email: 'demo@example.com',\n  password: 'demo123',\n  profilePicture: DEFAULT_PROFILE_IMAGE,\n});\n\nconst generateRandomString = (length = 64) => {\n  const possible =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let text = '';\n  for (let i = 0; i < length; i += 1) {\n    text += possible.charAt(Math.floor(Math.random() * possible.length));\n  }\n  return text;\n};\n\nconst base64UrlEncode = (arrayBuffer) => {\n  let string = '';\n  const bytes = new Uint8Array(arrayBuffer);\n  const len = bytes.byteLength;\n  for (let i = 0; i < len; i += 1) {\n    string += String.fromCharCode(bytes[i]);\n  }\n  return btoa(string).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n};\n\nconst createCodeChallenge = async (verifier) => {\n  if (typeof window === 'undefined' || !window.crypto?.subtle) {\n    throw new Error('Web Crypto API is not available.');\n  }\n  const encoder = new TextEncoder();\n  const data = encoder.encode(verifier);\n  const digest = await window.crypto.subtle.digest('SHA-256', data);\n  return base64UrlEncode(digest);\n};\n\nexport default function App() {\n  const [heartRate, setHeartRate] = useState(72);\n  const [isConnected, setIsConnected] = useState(false);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentSong, setCurrentSong] = useState(null);\n  const [queue, setQueue] = useState([]);\n  const [selectedWorkout, setSelectedWorkout] = useState('cardio');\n  const [showSetup, setShowSetup] = useState(false);\n  const [spotifyToken, setSpotifyToken] = useState(() => {\n    const stored = loadStoredSpotifyAuth();\n    return stored?.accessToken ?? null;\n  });\n  const [spotifyRefreshToken, setSpotifyRefreshToken] = useState(() => {\n    const stored = loadStoredSpotifyAuth();\n    return stored?.refreshToken ?? null;\n  });\n  const [spotifyTokenExpiresAt, setSpotifyTokenExpiresAt] = useState(() => {\n    const stored = loadStoredSpotifyAuth();\n    return stored?.expiresAt ?? null;\n  });\n  const [spotifyAuthInFlight, setSpotifyAuthInFlight] = useState(false);\n  const [spotifyError, setSpotifyError] = useState(null);\n  const [isFetchingTracks, setIsFetchingTracks] = useState(false);\n  const [trackError, setTrackError] = useState(null);\n\n  // State for music progress\n  const [currentPlaybackTime, setCurrentPlaybackTime] = useState(0); // in milliseconds\n\n  // Authentication states\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [showLogin, setShowLogin] = useState(true);\n  const [isSignUp, setIsSignUp] = useState(false);\n  const [showForgotUsername, setShowForgotUsername] = useState(false);\n  const [showForgotPassword, setShowForgotPassword] = useState(false);\n  const [showEmailSent, setShowEmailSent] = useState(false);\n  const [emailSentMessage, setEmailSentMessage] = useState('');\n\n  // Profile and Settings\n  const [userProfile, setUserProfile] = useState(null);\n  const [profilePictureUrl, setProfilePictureUrl] = useState(() => {\n    const storedDemoUser = loadDemoAuthUser();\n    return storedDemoUser?.profilePicture || DEFAULT_PROFILE_IMAGE;\n  });\n  const [showProfileSettings, setShowProfileSettings] = useState(false);\n\n  // Form states\n  const [loginIdentifier, setLoginIdentifier] = useState('');\n  const [loginPassword, setLoginPassword] = useState('');\n  const [signupName, setSignupName] = useState('');\n  const [signupUsername, setSignupUsername] = useState('');\n  const [signupEmail, setSignupEmail] = useState('');\n  const [signupPassword, setSignupPassword] = useState('');\n  const [signupConfirmPassword, setSignupConfirmPassword] = useState('');\n  const [forgotEmail, setForgotEmail] = useState('');\n  const [forgotError, setForgotError] = useState('');\n  const [signupError, setSignupError] = useState('');\n  const [loginError, setLoginError] = useState('');\n  const [profileUpdateSuccess, setProfileUpdateSuccess] = useState(false);\n  const [demoUser, setDemoUser] = useState(() => loadDemoAuthUser());\n  const isDemoAuthMode = !isFirebaseConfigured;\n  const [hasDemoSession, setHasDemoSession] = useState(() =>\n    loadDemoSessionFlag()\n  );\n\n  useEffect(() => {\n    if (!isDemoAuthMode) return;\n    persistDemoAuthUser(demoUser);\n  }, [demoUser, isDemoAuthMode]);\n\n  const ensureDemoUser = useCallback(() => {\n    if (demoUser) return demoUser;\n    const defaultUser = createDefaultDemoUser();\n    setDemoUser(defaultUser);\n    return defaultUser;\n  }, [demoUser]);\n\n  useEffect(() => {\n    if (!isDemoAuthMode) return;\n    setDemoSessionFlag(hasDemoSession);\n  }, [hasDemoSession, isDemoAuthMode]);\n\n  const disconnectSpotify = useCallback(() => {\n    setSpotifyToken(null);\n    setSpotifyRefreshToken(null);\n    setSpotifyTokenExpiresAt(null);\n    setSpotifyError(null);\n    setTrackError(null);\n  }, []);\n\n  const refreshSpotifyAccessToken = useCallback(\n    async (refreshToken) => {\n      if (\n        !refreshToken ||\n        !SPOTIFY_CLIENT_ID ||\n        SPOTIFY_CLIENT_ID.includes('YOUR_SPOTIFY_CLIENT_ID')\n      ) {\n        return null;\n      }\n      try {\n        const body = new URLSearchParams({\n          client_id: SPOTIFY_CLIENT_ID,\n          grant_type: 'refresh_token',\n          refresh_token: refreshToken,\n        });\n\n        const response = await fetch('https://accounts.spotify.com/api/token', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n          body: body.toString(),\n        });\n\n        if (!response.ok) {\n          const message = await response.text();\n          throw new Error(message || 'Unable to refresh Spotify token.');\n        }\n\n        const data = await response.json();\n        setSpotifyToken(data.access_token);\n        setSpotifyTokenExpiresAt(\n          Date.now() + ((data.expires_in ?? 3600) * 1000)\n        );\n        if (data.refresh_token) {\n          setSpotifyRefreshToken(data.refresh_token);\n        }\n        setSpotifyError(null);\n        return data.access_token;\n      } catch (error) {\n        setSpotifyError('Spotify session expired. Please reconnect.');\n        disconnectSpotify();\n        return null;\n      }\n    },\n    [disconnectSpotify]\n  );\n\n  const exchangeSpotifyCodeForToken = useCallback(\n    async (authorizationCode) => {\n      if (\n        !SPOTIFY_CLIENT_ID ||\n        SPOTIFY_CLIENT_ID.includes('YOUR_SPOTIFY_CLIENT_ID')\n      ) {\n        setSpotifyError(\n          'Set REACT_APP_SPOTIFY_CLIENT_ID before connecting to Spotify.'\n        );\n        return;\n      }\n\n      const verifier = sessionStorage.getItem('beat_spotify_code_verifier');\n      if (!verifier) {\n        setSpotifyError('Missing PKCE verifier. Start the login again.');\n        return;\n      }\n\n      setSpotifyAuthInFlight(true);\n\n      try {\n        const body = new URLSearchParams({\n          client_id: SPOTIFY_CLIENT_ID,\n          grant_type: 'authorization_code',\n          code: authorizationCode,\n          redirect_uri: SPOTIFY_REDIRECT_URI,\n          code_verifier: verifier,\n        });\n\n        const response = await fetch('https://accounts.spotify.com/api/token', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n          body: body.toString(),\n        });\n\n        if (!response.ok) {\n          const message = await response.text();\n          throw new Error(message || 'Unable to complete Spotify sign-in.');\n        }\n\n        const data = await response.json();\n        setSpotifyToken(data.access_token);\n        setSpotifyTokenExpiresAt(\n          Date.now() + ((data.expires_in ?? 3600) * 1000)\n        );\n        if (data.refresh_token) {\n          setSpotifyRefreshToken(data.refresh_token);\n        }\n        setIsConnected(true);\n        setShowSetup(false);\n        setSpotifyError(null);\n      } catch (error) {\n        setSpotifyError(error.message || 'Unable to complete Spotify sign-in.');\n      } finally {\n        setSpotifyAuthInFlight(false);\n        sessionStorage.removeItem('beat_spotify_code_verifier');\n        sessionStorage.removeItem('beat_spotify_auth_state');\n      }\n    },\n    [setIsConnected, setShowSetup]\n  );\n\n  useEffect(() => {\n    if (!spotifyToken) {\n      persistSpotifyAuth(null);\n      return;\n    }\n    persistSpotifyAuth({\n      accessToken: spotifyToken,\n      refreshToken: spotifyRefreshToken,\n      expiresAt: spotifyTokenExpiresAt,\n    });\n  }, [spotifyToken, spotifyRefreshToken, spotifyTokenExpiresAt]);\n\n  useEffect(() => {\n    if (!spotifyToken || !spotifyTokenExpiresAt) return;\n\n    const msUntilExpiry = spotifyTokenExpiresAt - Date.now();\n\n    if (msUntilExpiry <= 0) {\n      if (spotifyRefreshToken) {\n        refreshSpotifyAccessToken(spotifyRefreshToken);\n      } else {\n        disconnectSpotify();\n      }\n      return;\n    }\n\n    if (!spotifyRefreshToken) return;\n\n    const timeoutId = setTimeout(() => {\n      refreshSpotifyAccessToken(spotifyRefreshToken);\n    }, Math.max(1000, msUntilExpiry - 60000)); // refresh one minute early\n\n    return () => clearTimeout(timeoutId);\n  }, [\n    spotifyToken,\n    spotifyTokenExpiresAt,\n    spotifyRefreshToken,\n    refreshSpotifyAccessToken,\n    disconnectSpotify,\n  ]);\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    const params = new URLSearchParams(window.location.search);\n    const code = params.get('code');\n    const authError = params.get('error');\n    const stateParam = params.get('state');\n    const storedState = sessionStorage.getItem('beat_spotify_auth_state');\n\n    if (!code && !authError) return;\n\n    if (authError) {\n      setSpotifyError(`Spotify authorization failed: ${authError}`);\n      setSpotifyAuthInFlight(false);\n    } else if (code) {\n      if (storedState && stateParam !== storedState) {\n        setSpotifyError('Spotify authorization state mismatch. Please try again.');\n        sessionStorage.removeItem('beat_spotify_code_verifier');\n        sessionStorage.removeItem('beat_spotify_auth_state');\n      } else {\n        exchangeSpotifyCodeForToken(code);\n      }\n    }\n\n    params.delete('code');\n    params.delete('state');\n    params.delete('error');\n    const newQuery = params.toString();\n    const newUrl = `${window.location.pathname}${\n      newQuery ? `?${newQuery}` : ''\n    }${window.location.hash}`;\n    window.history.replaceState({}, document.title, newUrl);\n  }, [exchangeSpotifyCodeForToken]);\n\n\n\n  const workoutTypes = [\n    {\n      id: 'cardio',\n      name: 'Cardio',\n      icon: 'ðŸƒ',\n      color: 'bg-red-500',\n      range: '120-160 BPM',\n    },\n    {\n      id: 'strength',\n      name: 'Strength Training',\n      icon: 'ðŸ’ª',\n      color: 'bg-blue-500',\n      range: '90-120 BPM',\n    },\n    {\n      id: 'yoga',\n      name: 'Yoga/Stretching',\n      icon: 'ðŸ§˜',\n      color: 'bg-purple-500',\n      range: '60-90 BPM',\n    },\n    {\n      id: 'hiit',\n      name: 'HIIT',\n      icon: 'ðŸ”¥',\n      color: 'bg-orange-500',\n      range: '140-180 BPM',\n    },\n    {\n      id: 'warmup',\n      name: 'Warm Up',\n      icon: 'ðŸŒ…',\n      color: 'bg-yellow-500',\n      range: '80-100 BPM',\n    },\n    {\n      id: 'cooldown',\n      name: 'Cool Down',\n      icon: 'â„ï¸',\n      color: 'bg-cyan-500',\n      range: '60-80 BPM',\n    },\n  ];\n\n  // 1. Heart Rate Simulation (unchanged)\n  useEffect(() => {\n    if (!isConnected) return;\n\n    const interval = setInterval(() => {\n      setHeartRate((prev) => {\n        const change = Math.random() * 10 - 5;\n        const newRate = Math.max(50, Math.min(200, prev + change));\n        return Math.round(newRate);\n      });\n    }, 2000);\n\n    return () => clearInterval(interval);\n  }, [isConnected]);\n\n  // Mock Song Database - UPDATED with realistic durationMs\n  const getMockSongsForBPM = (bpm, workout) => {\n    const songs = [\n      // Duration in MS: 3:48\n      {\n        id: 1,\n        name: 'Electric Feel',\n        artist: 'MGMT',\n        bpm: 112,\n        workout: 'cardio',\n        durationMs: 228000,\n      },\n      // Duration in MS: 4:30\n      {\n        id: 2,\n        name: 'Uptown Funk',\n        artist: 'Bruno Mars',\n        bpm: 115,\n        workout: 'cardio',\n        durationMs: 270000,\n      },\n      // Duration in MS: 4:07\n      {\n        id: 3,\n        name: 'Stronger',\n        artist: 'Kanye West',\n        bpm: 104,\n        workout: 'strength',\n        durationMs: 247000,\n      },\n      // Duration in MS: 4:05\n      {\n        id: 4,\n        name: 'Eye of the Tiger',\n        artist: 'Survivor',\n        bpm: 109,\n        workout: 'strength',\n        durationMs: 245000,\n      },\n      // Duration in MS: 4:26\n      {\n        id: 5,\n        name: 'Breathe',\n        artist: 'Telepopmusik',\n        bpm: 72,\n        workout: 'yoga',\n        durationMs: 266000,\n      },\n      // Duration in MS: 10:25 (Longer for yoga)\n      {\n        id: 6,\n        name: 'Weightless',\n        artist: 'Marconi Union',\n        bpm: 60,\n        workout: 'yoga',\n        durationMs: 625000,\n      },\n      // Duration in MS: 4:28\n      {\n        id: 7,\n        name: 'Till I Collapse',\n        artist: 'Eminem',\n        bpm: 171,\n        workout: 'hiit',\n        durationMs: 268000,\n      },\n      // Duration in MS: 4:52\n      {\n        id: 8,\n        name: 'Thunderstruck',\n        artist: 'AC/DC',\n        bpm: 133,\n        workout: 'hiit',\n        durationMs: 292000,\n      },\n      // Duration in MS: 4:29\n      {\n        id: 9,\n        name: 'Cannot Stop',\n        artist: 'Red Hot Chili Peppers',\n        bpm: 118,\n        workout: 'cardio',\n        durationMs: 269000,\n      },\n      // Duration in MS: 5:26\n      {\n        id: 10,\n        name: 'Lose Yourself',\n        artist: 'Eminem',\n        bpm: 171,\n        workout: 'hiit',\n        durationMs: 326000,\n      },\n      // Duration in MS: 3:39\n      {\n        id: 11,\n        name: 'Work',\n        artist: 'Rihanna',\n        bpm: 92,\n        workout: 'strength',\n        durationMs: 219000,\n      },\n      // Duration in MS: 2:41\n      {\n        id: 12,\n        name: 'Sunflower',\n        artist: 'Post Malone',\n        bpm: 90,\n        workout: 'warmup',\n        durationMs: 161000,\n      },\n      // Duration in MS: 3:23\n      {\n        id: 13,\n        name: 'Levitating',\n        artist: 'Dua Lipa',\n        bpm: 103,\n        workout: 'cardio',\n        durationMs: 203000,\n      },\n      // Duration in MS: 3:20\n      {\n        id: 14,\n        name: 'Blinding Lights',\n        artist: 'The Weeknd',\n        bpm: 171,\n        workout: 'cardio',\n        durationMs: 200000,\n      },\n      // Duration in MS: 3:36\n      {\n        id: 15,\n        name: 'Do Not Stop Me Now',\n        artist: 'Queen',\n        bpm: 156,\n        workout: 'cardio',\n        durationMs: 216000,\n      },\n      // Duration in MS: 3:38\n      {\n        id: 16,\n        name: 'Shallow',\n        artist: 'Lady Gaga',\n        bpm: 96,\n        workout: 'warmup',\n        durationMs: 218000,\n      },\n      // Duration in MS: 4:32\n      {\n        id: 17,\n        name: 'Say Something',\n        artist: 'A Great Big World',\n        bpm: 72,\n        workout: 'yoga',\n        durationMs: 272000,\n      },\n      // Duration in MS: 5:09\n      {\n        id: 18,\n        name: 'The Scientist',\n        artist: 'Coldplay',\n        bpm: 73,\n        workout: 'cooldown',\n        durationMs: 309000,\n      },\n      // Duration in MS: 4:55\n      {\n        id: 19,\n        name: 'Fix You',\n        artist: 'Coldplay',\n        bpm: 68,\n        workout: 'cooldown',\n        durationMs: 295000,\n      },\n      // Duration in MS: 3:21\n      {\n        id: 20,\n        name: 'Skinny Love',\n        artist: 'Bon Iver',\n        bpm: 75,\n        workout: 'yoga',\n        durationMs: 201000,\n      },\n      // Duration in MS: 4:05\n      {\n        id: 21,\n        name: 'Gravity',\n        artist: 'John Mayer',\n        bpm: 70,\n        workout: 'cooldown',\n        durationMs: 245000,\n      },\n      // Duration in MS: 6:53\n      {\n        id: 22,\n        name: 'Hallelujah',\n        artist: 'Jeff Buckley',\n        bpm: 68,\n        workout: 'yoga',\n        durationMs: 413000,\n      },\n      // Duration in MS: 3:05\n      {\n        id: 23,\n        name: 'Mad World',\n        artist: 'Gary Jules',\n        bpm: 82,\n        workout: 'cooldown',\n        durationMs: 185000,\n      },\n      // Duration in MS: 4:27\n      {\n        id: 24,\n        name: 'Chasing Cars',\n        artist: 'Snow Patrol',\n        bpm: 76,\n        workout: 'cooldown',\n        durationMs: 267000,\n      },\n      // Duration in MS: 3:13\n      {\n        id: 25,\n        name: 'Physical',\n        artist: 'Dua Lipa',\n        bpm: 147,\n        workout: 'hiit',\n        durationMs: 193000,\n      },\n      // Duration in MS: 3:45\n      {\n        id: 26,\n        name: 'Higher Love',\n        artist: 'Kygo, Whitney Houston',\n        bpm: 104,\n        workout: 'cardio',\n        durationMs: 225000,\n      },\n      // Duration in MS: 2:37\n      {\n        id: 27,\n        name: 'Old Town Road',\n        artist: 'Lil Nas X',\n        bpm: 136,\n        workout: 'strength',\n        durationMs: 157000,\n      },\n      // Duration in MS: 3:52\n      {\n        id: 28,\n        name: 'Sweet Caroline',\n        artist: 'Neil Diamond',\n        bpm: 125,\n        workout: 'warmup',\n        durationMs: 232000,\n      },\n      // Duration in MS: 3:55\n      {\n        id: 29,\n        name: 'Strawberry Swing',\n        artist: 'Coldplay',\n        bpm: 90,\n        workout: 'yoga',\n        durationMs: 235000,\n      },\n      // Duration in MS: 2:54\n      {\n        id: 30,\n        name: 'One Dance',\n        artist: 'Drake',\n        bpm: 104,\n        workout: 'strength',\n        durationMs: 174000,\n      },\n    ];\n\n    const workoutSongs = songs.filter((s) => s.workout === workout);\n\n    // Filter songs that are within +/- 20 BPM of the current heart rate\n    return workoutSongs\n      .filter((song) => Math.abs(song.bpm - bpm) <= 20)\n      .map((song) => ({ ...song, bpmDiff: Math.abs(song.bpm - bpm) }))\n      .sort((a, b) => a.bpmDiff - b.bpmDiff) // Sort by closest BPM match\n      .slice(0, 8); // Only show the top 8 matches\n  };\n\n  const skipSong = useCallback(() => {\n    setQueue((prevQueue) => {\n      if (!currentSong) return prevQueue;\n\n      const nextIndex = prevQueue.findIndex((s) => s.id === currentSong.id) + 1;\n\n      if (nextIndex < prevQueue.length) {\n        setCurrentSong(prevQueue[nextIndex]);\n        return prevQueue;\n      } else if (prevQueue.length > 0) {\n        // Loop back to the first song if end of list is reached\n        setCurrentSong(prevQueue[0]);\n        return prevQueue;\n      } else {\n        setCurrentSong(null);\n        return prevQueue;\n      }\n    });\n  }, [currentSong]);\n\n  // Reset playback time when a new song is set\n  useEffect(() => {\n    if (currentSong) {\n      setCurrentPlaybackTime(0);\n      // Ensure player starts if a song is set\n      if (!isPlaying) {\n        setIsPlaying(true);\n      }\n    }\n  }, [currentSong]);\n\n  // Real-time Playback Timer and Auto-Skip\n  useEffect(() => {\n    // Only run if playing and a song is loaded\n    if (!isPlaying || !currentSong) {\n      return;\n    }\n\n    const trackDuration = getDurationMs(currentSong);\n\n    const interval = setInterval(() => {\n      setCurrentPlaybackTime((prev) => {\n        const newTime = prev + 1000;\n        // Check if song is over\n        if (newTime >= trackDuration) {\n          // Time is up, skip to next song\n          skipSong();\n          return 0; // The next useEffect handles the reset to 0 for the new song\n        }\n        return newTime;\n      });\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [isPlaying, currentSong, skipSong]);\n\n  // 2. LIVE QUEUEING MECHANISM (Triggers when heartRate changes)\n  useEffect(() => {\n    if (!isConnected) {\n      setQueue([]);\n      setCurrentSong(null);\n      setTrackError(null);\n      setIsFetchingTracks(false);\n      return;\n    }\n\n    if (!spotifyToken) {\n      const songsForBPM = getMockSongsForBPM(heartRate, selectedWorkout);\n\n      if (songsForBPM.length === 0) {\n        setQueue([]);\n        setCurrentSong(null);\n        setTrackError(\n          'No demo tracks found for this workout/BPM. Connect Spotify for live music.'\n        );\n        return;\n      }\n\n      setTrackError(null);\n      setIsFetchingTracks(false);\n      setQueue(songsForBPM);\n      setCurrentSong((prev) => {\n        if (prev && songsForBPM.some((song) => song.id === prev.id)) {\n          return prev;\n        }\n        if (isPlaying || !prev) {\n          return songsForBPM[0];\n        }\n        return prev;\n      });\n      return;\n    }\n\n    let cancelled = false;\n    const provider = new SpotifyTrackProvider(spotifyToken);\n\n    const fetchRecommendations = async () => {\n      setIsFetchingTracks(true);\n      setTrackError(null);\n      try {\n        const tracks = await provider.getRecommendations(\n          heartRate,\n          selectedWorkout\n        );\n        if (cancelled) return;\n\n        setQueue(tracks);\n        setCurrentSong((prev) => {\n          if (!tracks.length) return null;\n          if (prev && tracks.some((song) => song.id === prev.id)) {\n            return prev;\n          }\n          if (isPlaying || !prev) {\n            return tracks[0];\n          }\n          return prev;\n        });\n      } catch (error) {\n        if (cancelled) return;\n        const friendly =\n          error?.message?.startsWith('Spotify 404')\n            ? 'Spotify did not return any recommendations for this combo yet. Try another workout or reconnect.'\n            : error?.message || 'Unable to load Spotify recommendations.';\n        setTrackError(friendly);\n        setQueue([]);\n        setCurrentSong(null);\n      } finally {\n        if (!cancelled) {\n          setIsFetchingTracks(false);\n        }\n      }\n    };\n\n    fetchRecommendations();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [\n    heartRate,\n    selectedWorkout,\n    isConnected,\n    spotifyToken,\n    isPlaying,\n  ]);\n\n  /**\n   * Handler to allow user to scrub/jump to a new position in the song.\n   * @param {React.MouseEvent<HTMLDivElement>} e The mouse event from clicking the progress bar.\n   */\n  const handleScrub = (e) => {\n    if (!currentSong) return;\n\n    // Get the element and its boundaries\n    const progressBar = e.currentTarget;\n    const rect = progressBar.getBoundingClientRect();\n\n    // Calculate the click position relative to the element's start\n    const clickX = e.clientX - rect.left;\n    const width = rect.width;\n\n    // Calculate the new time ratio and convert to milliseconds\n    const newTimeRatio = clickX / width;\n    const newTimeMs = Math.floor(newTimeRatio * currentSong.durationMs);\n\n    // Update playback time\n    setCurrentPlaybackTime(\n      Math.max(0, Math.min(currentSong.durationMs, newTimeMs))\n    );\n\n    // Ensure playback restarts immediately if it was paused\n    if (!isPlaying) {\n      setIsPlaying(true);\n    }\n  };\n\n  // Authentication Handlers\n\n  const handleLogin = async (e) => {\n    e.preventDefault();\n    setLoginError(''); // Clear previous errors\n\n    if (!loginIdentifier.trim() || !loginPassword.trim()) {\n      setLoginError('Please enter a username/email and password');\n      return;\n    }\n\n    if (isDemoAuthMode) {\n      const localUser = ensureDemoUser();\n      const identifier = loginIdentifier.trim().toLowerCase();\n      const matchesEmail =\n        localUser.email?.toLowerCase() === identifier;\n      const matchesUsername =\n        localUser.username?.toLowerCase() === identifier;\n\n      if (!matchesEmail && !matchesUsername) {\n        setLoginError('Username or email not found.');\n        return;\n      }\n\n      if (localUser.password !== loginPassword) {\n        setLoginError('Incorrect password. Please try again.');\n        return;\n      }\n\n      setUserProfile({\n        name: localUser.name,\n        username: localUser.username,\n        email: localUser.email,\n        profilePicture: localUser.profilePicture,\n      });\n      setProfilePictureUrl(\n        localUser.profilePicture || DEFAULT_PROFILE_IMAGE\n      );\n      setIsAuthenticated(true);\n      setIsConnected(true);\n      setIsPlaying(true);\n      setHasDemoSession(true);\n      return;\n    }\n\n    try {\n      let email = loginIdentifier;\n\n      if (!loginIdentifier.includes('@')) {\n        const usersRef = collection(db, 'users');\n        const q = query(usersRef, where('username', '==', loginIdentifier));\n        const querySnapshot = await getDocs(q);\n\n        if (querySnapshot.empty) {\n          setLoginError('Username not found');\n          return;\n        }\n\n        email = querySnapshot.docs[0].data().email;\n      }\n\n      const userCred = await signInWithEmailAndPassword(\n        auth,\n        email,\n        loginPassword\n      );\n\n      if (!userCred.user.emailVerified) {\n        await sendEmailVerification(userCred.user);\n        setLoginError(\n          'Please verify your email before logging in. Verification email resent!'\n        );\n        return;\n      }\n\n      const userDocRef = doc(db, 'users', userCred.user.uid);\n      let userData = null;\n\n      try {\n        const userDocSnap = await getDoc(userDocRef);\n        userData =\n          userDocSnap?.exists() && typeof userDocSnap.data === 'function'\n            ? userDocSnap.data() ?? null\n            : null;\n      } catch (docError) {\n        console.error('Error fetching user profile:', docError);\n      }\n\n      if (userData && typeof userData === 'object') {\n        setUserProfile(userData);\n        setProfilePictureUrl(userData?.profilePicture || DEFAULT_PROFILE_IMAGE);\n      } else {\n        setUserProfile({ email: userCred.user.email });\n        setProfilePictureUrl(DEFAULT_PROFILE_IMAGE);\n      }\n\n      setIsAuthenticated(true);\n      setIsConnected(true);\n      setIsPlaying(true);\n    } catch (error) {\n      if (error.code === 'auth/too-many-requests') {\n        setLoginError(\n          'Too many failed attempts. Please wait a few minutes before trying again.'\n        );\n      } else if (error.code === 'auth/user-not-found') {\n        setLoginError('Username or email not found.');\n      } else if (error.code === 'auth/wrong-password') {\n        setLoginError('Incorrect password. Please try again.');\n      } else if (error.code === 'auth/invalid-credential') {\n        setLoginError('Incorrect password. Please try again.');\n      } else {\n        setLoginError(error.message);\n      }\n    }\n  };\n\n\n\n\n\n\n\n\n  const handleSignUp = async () => {\n    setSignupError(\"\"); // clear previous errors\n\n    if (\n      !signupName.trim() ||\n      !signupUsername.trim() ||\n      !signupEmail.trim() ||\n      !signupPassword.trim() ||\n      !signupConfirmPassword.trim()\n    ) {\n      setSignupError(\"Please fill in all fields.\");\n      return;\n    }\n\n    if (!EMAIL_REGEX.test(signupEmail)) {\n      setSignupError(\"Please enter a valid email address.\");\n      return;\n    }\n\n    if (signupPassword !== signupConfirmPassword) {\n      setSignupError(\"Passwords do not match!\");\n      return;\n    }\n\n    try {\n      if (isDemoAuthMode) {\n        const emailLower = signupEmail.toLowerCase();\n        const usernameLower = signupUsername.toLowerCase();\n        if (\n          demoUser &&\n          (demoUser.email?.toLowerCase() === emailLower ||\n            demoUser.username?.toLowerCase() === usernameLower)\n        ) {\n          setSignupError(\"An account already exists in local demo mode. Try logging in.\");\n          return;\n        }\n\n        const newUser = {\n          name: signupName,\n          username: signupUsername,\n          email: signupEmail,\n          password: signupPassword,\n          profilePicture: DEFAULT_PROFILE_IMAGE,\n        };\n\n        setDemoUser(newUser);\n        setSignupError(\"Local account created! Sign in to continue.\");\n        setSignupName(\"\");\n        setSignupUsername(\"\");\n        setSignupEmail(\"\");\n        setSignupPassword(\"\");\n        setSignupConfirmPassword(\"\");\n        setIsSignUp(false);\n        setShowLogin(true);\n        return;\n      }\n\n      // âœ… Create account in Firebase Auth\n      const userCred = await createUserWithEmailAndPassword(\n        auth,\n        signupEmail,\n        signupPassword\n      );\n\n      // âœ… Send verification email\n      await sendEmailVerification(userCred.user);\n\n      // âŒ Don't log in yet\n      await signOut(auth); // make sure user is signed out until verified\n\n      // âœ… Save username + name in Firestore\n      await setDoc(doc(db, \"users\", userCred.user.uid), {\n        name: signupName,\n        username: signupUsername,\n        email: signupEmail,\n      });\n\n      // âœ… Show in-app message instead of alert\n      setSignupError(\"Verification email sent! Please check your inbox before logging in.\");\n\n      // Optionally, clear signup fields\n      setSignupName(\"\");\n      setSignupUsername(\"\");\n      setSignupEmail(\"\");\n      setSignupPassword(\"\");\n      setSignupConfirmPassword(\"\");\n\n    } catch (error) {\n      setSignupError(error.message); // still shows errors in red box\n    }\n  };\n\n\n\n\n  // Handlers for Forgot/Reset Flows (omitted for brevity, unchanged)\n  const handleForgotUsername = () => {\n    setForgotError('');\n    if (!forgotEmail.trim() || !EMAIL_REGEX.test(forgotEmail)) {\n      setForgotError('Please enter a valid email address.');\n      return;\n    }\n    setEmailSentMessage(\n      `An email with your username has been sent to ${forgotEmail}.`\n    );\n    setShowEmailSent(true);\n    setShowForgotUsername(false);\n  };\n\n  const handleForgotPassword = () => {\n    setForgotError('');\n    if (!forgotEmail.trim() || !EMAIL_REGEX.test(forgotEmail)) {\n      setForgotError('Please enter a valid email address.');\n      return;\n    }\n    setEmailSentMessage(\n      `A password reset link has been sent to ${forgotEmail}.`\n    );\n    setShowEmailSent(true);\n    setShowForgotPassword(false);\n  };\n\n  const handleLogout = () => {\n    disconnectSpotify();\n    setIsAuthenticated(false);\n    setUserProfile(null);\n    setIsConnected(false);\n    setShowSetup(false);\n    setShowProfileSettings(false);\n    setProfilePictureUrl(\n      DEFAULT_PROFILE_IMAGE\n    );\n    setLoginIdentifier('');\n    setLoginPassword('');\n    setShowLogin(true);\n    setIsSignUp(false);\n    setShowEmailSent(false);\n    setForgotEmail('');\n    setForgotError('');\n    setCurrentSong(null);\n    setIsPlaying(false);\n    setQueue([]);\n    setCurrentPlaybackTime(0);\n    setHasDemoSession(false);\n  };\n\n  const handleProfilePictureChange = async (newUrl) => {\n    const finalUrl = newUrl || DEFAULT_PROFILE_IMAGE;\n    const completeUpdate = () => {\n      setProfilePictureUrl(finalUrl);\n      setUserProfile((prev) =>\n        prev\n          ? {\n              ...prev,\n              profilePicture: finalUrl,\n            }\n          : prev\n      );\n      setProfileUpdateSuccess(true);\n      setTimeout(() => {\n        setShowProfileSettings(false);\n        setProfileUpdateSuccess(false);\n      }, 2000);\n    };\n\n    if (isDemoAuthMode) {\n      setDemoUser((prev) =>\n        prev\n          ? {\n              ...prev,\n              profilePicture: finalUrl,\n            }\n          : prev\n      );\n      completeUpdate();\n      return;\n    }\n\n    try {\n      if (!auth?.currentUser) {\n        console.error('No user logged in!');\n        return;\n      }\n\n      const userRef = doc(db, 'users', auth.currentUser.uid);\n      await updateDoc(userRef, { profilePicture: finalUrl });\n      completeUpdate();\n    } catch (error) {\n      console.error('Error updating profile picture:', error.message);\n      alert('Error saving profile picture: ' + error.message);\n    }\n  };\n\n\n  const initiateSpotifyAuth = useCallback(async () => {\n    setSpotifyError(null);\n\n    if (\n      !SPOTIFY_CLIENT_ID ||\n      SPOTIFY_CLIENT_ID.includes('YOUR_SPOTIFY_CLIENT_ID')\n    ) {\n      setSpotifyError(\n        'Set REACT_APP_SPOTIFY_CLIENT_ID before connecting to Spotify.'\n      );\n      return;\n    }\n\n    if (typeof window === 'undefined' || !window.crypto?.subtle) {\n      setSpotifyError(\n        'This device does not support the Web Crypto APIs required for Spotify login.'\n      );\n      return;\n    }\n\n    try {\n      setSpotifyAuthInFlight(true);\n      const verifier = generateRandomString(64);\n      const challenge = await createCodeChallenge(verifier);\n      const state = generateRandomString(16);\n\n      sessionStorage.setItem('beat_spotify_code_verifier', verifier);\n      sessionStorage.setItem('beat_spotify_auth_state', state);\n\n      const params = new URLSearchParams({\n        response_type: 'code',\n        client_id: SPOTIFY_CLIENT_ID,\n        redirect_uri: SPOTIFY_REDIRECT_URI,\n        scope: SPOTIFY_SCOPES,\n        code_challenge_method: 'S256',\n        code_challenge: challenge,\n        state,\n      });\n\n      window.location.assign(\n        `https://accounts.spotify.com/authorize?${params.toString()}`\n      );\n    } catch (error) {\n      console.error('Spotify auth error:', error);\n      setSpotifyAuthInFlight(false);\n      setSpotifyError(\n        error?.message || 'Unable to start Spotify authorization.'\n      );\n    }\n  }, []);\n\n  // Legacy helper (kept for backward compatibility)\n  const handleProfilePictureSave = async () => {\n    handleProfilePictureChange(profilePictureUrl);\n  };\n\n  const continueInDemoMode = () => {\n    if (!isDemoAuthMode) return;\n    const user = ensureDemoUser();\n    setUserProfile({\n      name: user.name,\n      username: user.username,\n      email: user.email,\n      profilePicture: user.profilePicture,\n    });\n    setProfilePictureUrl(user.profilePicture || DEFAULT_PROFILE_IMAGE);\n    setIsAuthenticated(true);\n    setIsConnected(true);\n    setIsPlaying(true);\n    setShowLogin(false);\n    setIsSignUp(false);\n    setShowForgotUsername(false);\n    setShowForgotPassword(false);\n    setShowEmailSent(false);\n    setLoginError('');\n    setSignupError('');\n    setHasDemoSession(true);\n  };\n\n\n  const togglePlayback = () => {\n    const newPlayingState = !isPlaying;\n    setIsPlaying(newPlayingState);\n\n    // If starting playback and no song is loaded, load the first queue song\n    if (newPlayingState && !currentSong && queue.length > 0) {\n      setCurrentSong(queue[0]);\n    }\n  };\n\n  const getHeartRateColor = (hr) => {\n    if (hr < 100) return 'text-green-500';\n    if (hr < 140) return 'text-yellow-500';\n    if (hr < 170) return 'text-orange-500';\n    return 'text-red-500';\n  };\n\n  // Profile Settings Modal Component (omitted for brevity, unchanged)\n  const ProfileSettingsModal = () => {\n    const [tempUrl, setTempUrl] = useState(profilePictureUrl || '');\n\n    useEffect(() => {\n      if (showProfileSettings) {\n        setTempUrl(profilePictureUrl || '');\n      }\n    }, [showProfileSettings]);\n\n    const handleSave = () => {\n      handleProfilePictureChange(tempUrl);\n    };\n\n    return (\n      <div className=\"fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4\">\n        {profileUpdateSuccess && (\n          <div className=\"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in-out\">\n            Profile picture updated successfully!\n          </div>\n        )}\n        <div className=\"bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-md w-full border border-gray-700\">\n          <h2 className=\"text-2xl font-bold text-white mb-6\">Profile Settings</h2>\n\n          <div className=\"flex flex-col items-center mb-6\">\n            <img\n              src={tempUrl || DEFAULT_PROFILE_IMAGE}\n              alt=\"Profile\"\n              className=\"w-24 h-24 rounded-full object-cover mb-4 border-4 border-purple-500 shadow-xl\"\n            />\n            {/* File input logic omitted for brevity */}\n          </div>\n\n          <div className=\"space-y-4\">\n            <input\n              type=\"text\"\n              value={tempUrl}\n              onChange={(e) => setTempUrl(e.target.value)}\n              placeholder=\"Enter new image URL\"\n              className=\"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"\n            />\n            <button\n              onClick={handleSave}\n              className=\"w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition-all\"\n            >\n              Save Picture\n            </button>\n            <button\n              onClick={() => {\n                setShowProfileSettings(false);\n                setProfileUpdateSuccess(false);\n              }}\n              className=\"w-full bg-gray-700 text-gray-300 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-all\"\n            >\n              Close\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  if (showProfileSettings) {\n    return <ProfileSettingsModal />;\n  }\n\n  useEffect(() => {\n    if (!isDemoAuthMode || isAuthenticated || !hasDemoSession) return;\n    continueInDemoMode();\n  }, [isDemoAuthMode, isAuthenticated, hasDemoSession]);\n\n  // --- Authentication UI ---\n  if (!isAuthenticated) {\n    // ... [Authentication UI Code Here - Unchanged from previous step] ...\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-4 flex items-center justify-center\">\n        <div className=\"max-w-md w-full\">\n          <div className=\"bg-gray-800 rounded-2xl shadow-2xl p-8 border border-gray-700\">\n            <div className=\"text-center mb-8\">\n              <div className=\"flex justify-center mb-4\">\n                <div className=\"bg-white p-4 rounded-2xl shadow-lg\">\n                  <Heart\n                    className=\"w-12 h-12 text-red-500\"\n                    fill=\"currentColor\"\n                  />\n                </div>\n              </div>\n              <h1 className=\"text-3xl font-bold text-white mb-2\">Beat</h1>\n              <p className=\"text-gray-400\">\n                Your music, synced to your heartbeat\n              </p>\n            </div>\n\n            {showForgotUsername && (\n              <div>\n                <h2 className=\"text-2xl font-bold text-white mb-6\">\n                  Recover Username\n                </h2>\n                <p className=\"text-gray-400 mb-4\">\n                  Enter your email address and we'll send you your username.\n                </p>\n                {forgotError && (\n                  <div className=\"bg-red-900/50 border border-red-500 text-red-300 p-3 rounded-lg mb-4 text-sm\">\n                    {forgotError}\n                  </div>\n                )}\n                <div className=\"space-y-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Email\n                    </label>\n                    <div className=\"relative\">\n                      <Mail className=\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\" />\n                      <input\n                        type=\"email\"\n                        value={forgotEmail}\n                        onChange={(e) => {\n                          setForgotEmail(e.target.value);\n                          setForgotError('');\n                        }}\n                        placeholder=\"your@email.com\"\n                        className=\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                      />\n                    </div>\n                  </div>\n                  <button\n                    onClick={handleForgotUsername}\n                    className=\"w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition-all\"\n                  >\n                    Send Username\n                  </button>\n                </div>\n                <div className=\"mt-6 text-center\">\n                  <button\n                    onClick={() => {\n                      setShowForgotUsername(false);\n                      setShowLogin(true);\n                      setForgotEmail('');\n                      setForgotError('');\n                    }}\n                    className=\"text-purple-400 hover:text-purple-300 font-semibold transition-colors\"\n                  >\n                    <ArrowLeft className=\"w-4 h-4 inline-block mr-2\" /> Back to\n                    Sign In\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {showForgotPassword && (\n              <div>\n                <h2 className=\"text-2xl font-bold text-white mb-6\">\n                  Reset Password\n                </h2>\n                <p className=\"text-gray-400 mb-4\">\n                  Enter your email address and we'll send you a reset link.\n                </p>\n                {forgotError && (\n                  <div className=\"bg-red-900/50 border border-red-500 text-red-300 p-3 rounded-lg mb-4 text-sm\">\n                    {forgotError}\n                  </div>\n                )}\n                <div className=\"space-y-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Email\n                    </label>\n                    <div className=\"relative\">\n                      <Mail className=\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\" />\n                      <input\n                        type=\"email\"\n                        value={forgotEmail}\n                        onChange={(e) => {\n                          setForgotEmail(e.target.value);\n                          setForgotError('');\n                        }}\n                        placeholder=\"your@email.com\"\n                        className=\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                      />\n                    </div>\n                  </div>\n                  <button\n                    onClick={handleForgotPassword}\n                    className=\"w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition-all\"\n                  >\n                    Send Reset Link\n                  </button>\n                </div>\n                <div className=\"mt-6 text-center\">\n                  <button\n                    onClick={() => {\n                      setShowForgotPassword(false);\n                      setShowLogin(true);\n                      setForgotEmail('');\n                      setForgotError('');\n                    }}\n                    className=\"text-purple-400 hover:text-purple-300 font-semibold transition-colors\"\n                  >\n                    <ArrowLeft className=\"w-4 h-4 inline-block mr-2\" /> Back to\n                    Sign In\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {showEmailSent && (\n              <div className=\"text-center p-4\">\n                <Mail className=\"w-12 h-12 text-green-500 mx-auto mb-4\" />\n                <h2 className=\"text-2xl font-bold text-white mb-4\">Success!</h2>\n                <p className=\"text-gray-400 mb-6\">{emailSentMessage}</p>\n                <button\n                  onClick={() => {\n                    setShowEmailSent(false);\n                    setShowLogin(true);\n                    setForgotEmail('');\n                    setForgotError('');\n                  }}\n                  className=\"w-full bg-purple-500 text-white py-3 rounded-lg font-semibold hover:bg-purple-600 transition-all\"\n                >\n                  OK\n                </button>\n              </div>\n            )}\n\n            {showLogin &&\n              !isSignUp &&\n              !showForgotUsername &&\n              !showForgotPassword &&\n              !showEmailSent && (\n                <div>\n                  <h2 className=\"text-2xl font-bold text-white mb-6\">\n                    Sign In\n                  </h2>\n                  {isDemoAuthMode && (\n                    <div className=\"bg-blue-900/40 border border-blue-500 text-blue-100 p-3 rounded-lg mb-4 text-sm\">\n                      Local demo auth mode is active. Accounts you create here live only in this browser.\n                    </div>\n                  )}\n                  {loginError && (\n                    <div className=\"bg-red-900/50 border border-red-500 text-red-300 p-3 rounded-lg mb-4 text-sm\">\n                      {loginError}\n                    </div>\n                  )}\n                  <div className=\"space-y-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                        Email or Username\n                      </label>\n                      <div className=\"relative\">\n                        <Mail className=\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\" />\n                        <input\n                          type=\"text\"\n                          value={loginIdentifier}\n                          onChange={(e) => setLoginIdentifier(e.target.value)}\n                          placeholder=\"username or your@email.com\"\n                          className=\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                        />\n                      </div>\n                    </div>\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                        Password\n                      </label>\n                      <div className=\"relative\">\n                        <Lock className=\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\" />\n                        <input\n                          type=\"password\"\n                          value={loginPassword}\n                          onChange={(e) => setLoginPassword(e.target.value)}\n                          placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\n                          className=\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <button\n                        type=\"button\"\n                        onClick={() => {\n                          setShowForgotUsername(true);\n                          setShowLogin(false);\n                        }}\n                        className=\"text-purple-400 hover:text-purple-300 transition-colors\"\n                      >\n                        Forgot username?\n                      </button>\n                      <button\n                        type=\"button\"\n                        onClick={() => {\n                          setShowForgotPassword(true);\n                          setShowLogin(false);\n                        }}\n                        className=\"text-purple-400 hover:text-purple-300 transition-colors\"\n                      >\n                        Forgot password?\n                      </button>\n                    </div>\n\n                    <button\n                      onClick={handleLogin}\n                      className=\"w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition-all\"\n                    >\n                      Sign In\n                    </button>\n                    {isDemoAuthMode && (\n                      <button\n                        type=\"button\"\n                        onClick={continueInDemoMode}\n                        className=\"w-full mt-3 bg-gray-700 text-gray-200 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-all\"\n                      >\n                        Continue as guest (demo mode)\n                      </button>\n                    )}\n                  </div>\n\n                  <div className=\"mt-6 text-center\">\n                    <p className=\"text-gray-400\">\n                      Don't have an account?{' '}\n                      <button\n                        onClick={() => setIsSignUp(true)}\n                        className=\"text-purple-400 hover:text-purple-300 font-semibold transition-colors\"\n                      >\n                        Sign Up\n                      </button>\n                    </p>\n                  </div>\n                </div>\n              )}\n\n            {isSignUp && (\n              <div>\n                <h2 className=\"text-2xl font-bold text-white mb-6\">\n                  Create Account\n                </h2>\n                {isDemoAuthMode && (\n                  <div className=\"bg-blue-900/40 border border-blue-500 text-blue-100 p-3 rounded-lg mb-4 text-sm\">\n                    This account lives only in your browser while Firebase is disconnected.\n                  </div>\n                )}\n\n                {signupError && (\n                  <div className=\"bg-red-900/50 border border-red-500 text-red-300 p-3 rounded-lg mb-4 text-sm\">\n                    {signupError}\n                  </div>\n                )}\n\n                <div className=\"space-y-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Full Name\n                    </label>\n                    <div className=\"relative\">\n                      <User className=\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\" />\n                      <input\n                        type=\"text\"\n                        value={signupName}\n                        onChange={(e) => setSignupName(e.target.value)}\n                        placeholder=\"John Doe\"\n                        className=\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                      />\n                    </div>\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Username\n                    </label>\n                    <div className=\"relative\">\n                      <User className=\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\" />\n                      <input\n                        type=\"text\"\n                        value={signupUsername}\n                        onChange={(e) => setSignupUsername(e.target.value)}\n                        placeholder=\"mybeatname\"\n                        className=\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                      />\n                    </div>\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Email\n                    </label>\n                    <div className=\"relative\">\n                      <Mail className=\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\" />\n                      <input\n                        type=\"email\"\n                        value={signupEmail}\n                        onChange={(e) => setSignupEmail(e.target.value)}\n                        placeholder=\"your@email.com\"\n                        className=\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                      />\n                    </div>\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Password\n                    </label>\n                    <div className=\"relative\">\n                      <Lock className=\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\" />\n                      <input\n                        type=\"password\"\n                        value={signupPassword}\n                        onChange={(e) => setSignupPassword(e.target.value)}\n                        placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\n                        className=\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                      />\n                    </div>\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Confirm Password\n                    </label>\n                    <div className=\"relative\">\n                      <Lock className=\"absolute left-3 top-3.5 w-5 h-5 text-gray-400\" />\n                      <input\n                        type=\"password\"\n                        value={signupConfirmPassword}\n                        onChange={(e) =>\n                          setSignupConfirmPassword(e.target.value)\n                        }\n                        placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\n                        className=\"w-full pl-10 pr-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                      />\n                    </div>\n                  </div>\n                  <button\n                    onClick={handleSignUp}\n                    className=\"w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all\"\n                  >\n                    Create Account\n                  </button>\n                </div>\n\n                <div className=\"mt-6 text-center\">\n                  <p className=\"text-gray-400\">\n                    Already have an account?{' '}\n                    <button\n                      onClick={() => setIsSignUp(false)}\n                      className=\"text-purple-400 hover:text-purple-300 font-semibold transition-colors\"\n                    >\n                      Sign In\n                    </button>\n                  </p>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // --- SPOTIFY SETUP UI (omitted for brevity, unchanged) ---\n  if (showSetup) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-8\">\n        <div className=\"max-w-2xl mx-auto\">\n          <div className=\"bg-gray-800 rounded-2xl shadow-2xl p-8 border border-gray-700\">\n            <div className=\"text-center mb-8\">\n              <div className=\"flex justify-center mb-4\">\n                <div className=\"bg-white p-4 rounded-2xl shadow-lg\">\n                  <Heart\n                    className=\"w-12 h-12 text-red-500\"\n                    fill=\"currentColor\"\n                  />\n                </div>\n              </div>\n              <h1 className=\"text-3xl font-bold text-white mb-2\">Beat Setup</h1>\n              <p className=\"text-gray-400\">\n                Connect your Spotify account to sync your music\n              </p>\n            </div>\n\n            <div className=\"space-y-6\">\n              {spotifyError && (\n                <div className=\"bg-red-900/40 border border-red-700 text-red-100 rounded-lg p-4 text-sm\">\n                  {spotifyError}\n                </div>\n              )}\n\n              <div className=\"bg-gray-700 rounded-lg p-6 text-center space-y-4\">\n                <div>\n                  <h3 className=\"text-xl font-semibold text-white mb-2\">\n                    Authorize Spotify\n                  </h3>\n                  <p className=\"text-gray-400\">\n                    We use Spotify&apos;s browser-based PKCE flow, so it works\n                    on Firebase Hosting without a custom backend.\n                  </p>\n                </div>\n\n                <button\n                  onClick={initiateSpotifyAuth}\n                  disabled={spotifyAuthInFlight}\n                  className={`w-full py-3 rounded-lg font-semibold transition-all ${\n                    spotifyAuthInFlight\n                      ? 'bg-gray-600 text-gray-300 cursor-not-allowed'\n                      : 'bg-gradient-to-r from-green-500 to-green-600 text-white hover:from-green-600 hover:to-green-700'\n                  }`}\n                >\n                  {spotifyAuthInFlight ? 'Opening Spotifyâ€¦' : 'Connect with Spotify'}\n                </button>\n\n                <p className=\"text-sm text-gray-400\">\n                  Make sure{' '}\n                  <span className=\"text-white font-mono\">\n                    {SPOTIFY_REDIRECT_URI}\n                  </span>{' '}\n                  is added as a Redirect URI in your Spotify Developer\n                  Dashboard.\n                </p>\n              </div>\n\n              {spotifyToken && (\n                <div className=\"bg-green-900/30 border border-green-600 rounded-lg p-6 text-center space-y-4\">\n                  <div>\n                    <h3 className=\"text-xl font-semibold text-white\">\n                      Spotify Connected\n                    </h3>\n                    <p className=\"text-green-100 text-sm\">\n                      Your Firebase-hosted app is linked to Spotify. Close this\n                      dialog to start syncing live tracks.\n                    </p>\n                  </div>\n                  <div className=\"flex flex-col md:flex-row gap-3\">\n                    <button\n                      onClick={() => setShowSetup(false)}\n                      className=\"flex-1 bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-500 transition-colors\"\n                    >\n                      Back to Dashboard\n                    </button>\n                    <button\n                      onClick={disconnectSpotify}\n                      className=\"flex-1 bg-gray-800 border border-gray-600 text-gray-100 py-2 rounded-lg font-semibold hover:bg-gray-700 transition-colors\"\n                    >\n                      Disconnect Spotify\n                    </button>\n                  </div>\n                </div>\n              )}\n\n              <div className=\"flex items-center justify-center\">\n                <div className=\"w-full border-t border-gray-700\"></div>\n                <span className=\"px-3 text-gray-500 text-sm\">OR</span>\n                <div className=\"w-full border-t border-gray-700\"></div>\n              </div>\n\n              <button\n                onClick={() => {\n                  disconnectSpotify();\n                  setIsConnected(true);\n                  setShowSetup(false);\n                  setIsPlaying(true);\n                }}\n                className=\"w-full bg-gray-700 text-gray-300 py-3 rounded-lg text-lg hover:bg-gray-600 transition-all\"\n              >\n                Continue without Spotify (Demo Mode)\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // MAIN APPLICATION UI\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-4 md:p-8\">\n      <div className=\"max-w-6xl mx-auto\">\n        {/* Header with Profile (omitted for brevity, unchanged) */}\n        <div className=\"flex justify-between items-center mb-8\">\n          <div className=\"flex items-center\">\n            <div className=\"w-12 h-12 bg-white rounded-xl flex items-center justify-center mr-3 shadow-lg\">\n              <Heart className=\"w-8 h-8 text-red-500\" fill=\"currentColor\" />\n            </div>\n            <div>\n              <h1 className=\"text-3xl font-bold text-white\">Beat</h1>\n              <p className=\"text-gray-400 text-sm\">\n                {spotifyToken\n                  ? 'Spotify live mode Â· playlists refresh with your BPM'\n                  : 'Demo mode Â· connect Spotify to stream real recommendations'}\n              </p>\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"bg-gray-800 rounded-xl p-3 flex items-center space-x-3 border border-gray-700\">\n              <div\n                className=\"w-10 h-10 rounded-full overflow-hidden cursor-pointer group relative\"\n                onClick={() => setShowProfileSettings(true)}\n              >\n                <img\n                  src={profilePictureUrl}\n                  alt=\"Profile\"\n                  className=\"w-full h-full object-cover\"\n                />\n                <div className=\"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\">\n                  <Camera className=\"w-5 h-5 text-white\" />\n                </div>\n              </div>\n              <div className=\"hidden md:block\">\n                <p className=\"text-white font-semibold text-sm\">\n                  {userProfile?.name}\n                </p>\n                <p className=\"text-gray-400 text-xs\">\n                  @{userProfile?.username}\n                </p>\n              </div>\n              <button\n                onClick={handleLogout}\n                className=\"ml-2 px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-sm rounded-lg transition-colors\"\n              >\n                <LogOut className=\"w-4 h-4\" />\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid md:grid-cols-3 gap-6\">\n          <div className=\"md:col-span-2 bg-gray-800 rounded-2xl shadow-2xl p-6 border border-gray-700\">\n            <div className=\"flex justify-between items-start mb-6\">\n              <div>\n                <h2 className=\"text-xl font-semibold text-white mb-1\">\n                  Current Heart Rate\n                </h2>\n                <p className=\"text-gray-400 text-sm\">Live monitoring active</p>\n              </div>\n              <button\n                onClick={() => setShowSetup(true)}\n                className=\"p-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors\"\n              >\n                <Settings className=\"w-5 h-5 text-gray-300\" />\n              </button>\n            </div>\n\n            <div className=\"flex items-center justify-center mb-8\">\n              <div className=\"relative\">\n                <div className=\"absolute inset-0 bg-gradient-to-r from-red-500 to-pink-500 rounded-full blur-xl opacity-50\"></div>\n                <div className=\"relative bg-gray-900 rounded-full p-8\">\n                  <Heart\n                    className={`w-16 h-16 ${getHeartRateColor(\n                      heartRate\n                    )} animate-pulse`}\n                  />\n                </div>\n              </div>\n              <div className=\"ml-8\">\n                <div\n                  className={`text-6xl font-bold ${getHeartRateColor(\n                    heartRate\n                  )}`}\n                >\n                  {heartRate}\n                </div>\n                <div className=\"text-gray-400 text-xl\">BPM</div>\n              </div>\n            </div>\n\n            {currentSong ? (\n              <div className=\"bg-gradient-to-br from-gray-700 to-gray-800 rounded-xl p-6 mb-6 border border-gray-600\">\n                <div className=\"flex items-center space-x-6\">\n                  <div className=\"w-24 h-24 bg-gradient-to-br from-red-500 to-pink-500 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0\">\n                    <Music className=\"w-12 h-12 text-white\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-gray-400 text-xs uppercase tracking-wide mb-1\">\n                      Now Playing\n                    </p>\n                    <h3 className=\"text-white font-bold text-2xl mb-1 truncate\">\n                      {currentSong.name}\n                    </h3>\n                    <p className=\"text-gray-300 text-lg truncate mb-2\">\n                      {currentSong.artist}\n                    </p>\n                    <div className=\"flex items-center space-x-3\">\n                      <span className=\"bg-green-500/20 text-green-400 text-sm font-semibold px-3 py-1 rounded-full\">\n                        {formatBpm(currentSong.bpm)}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Progress Bar and Time Display */}\n                <div className=\"mt-6 flex items-center space-x-4\">\n                  <button\n                    onClick={togglePlayback}\n                    className=\"bg-green-500 hover:bg-green-600 text-white p-4 rounded-full transition-colors shadow-lg\"\n                  >\n                    {isPlaying ? (\n                      <Pause className=\"w-6 h-6\" />\n                    ) : (\n                      <Play className=\"w-6 h-6 ml-0.5\" />\n                    )}\n                  </button>\n                  <button\n                    onClick={skipSong}\n                    className=\"bg-gray-600 hover:bg-gray-500 text-white p-4 rounded-full transition-colors\"\n                  >\n                    <SkipForward className=\"w-6 h-6\" />\n                  </button>\n\n                  {/* Current Playback Time */}\n                  <span className=\"text-gray-400 text-sm\">\n                    {formatTime(currentPlaybackTime)}\n                  </span>\n\n                  {/* Dynamic Progress Bar (Scrubbing Enabled) */}\n                  <div\n                    className=\"flex-1 bg-gray-600 h-2 rounded-full overflow-hidden cursor-pointer group\"\n                    onClick={handleScrub}\n                  >\n                    <div\n                      className=\"bg-green-500 h-full transition-none\"\n                      style={{\n                        width: `${\n                          Math.min(\n                            100,\n                            (currentPlaybackTime / getDurationMs(currentSong)) *\n                              100\n                          )\n                        }%`,\n                        // Add a subtle hover effect for better scrubbing feel\n                        boxShadow: '0 0 10px rgba(16, 185, 129, 0.5)',\n                      }}\n                    ></div>\n                  </div>\n\n                  {/* Total Duration Time */}\n                  <span className=\"text-gray-400 text-sm\">\n                    {formatTime(currentSong.durationMs)}\n                  </span>\n                </div>\n              </div>\n            ) : (\n              <div className=\"bg-gray-700 rounded-xl p-6 mb-6 text-center text-gray-400 border border-gray-600\">\n                <Music className=\"w-8 h-8 mx-auto mb-2\" />\n                <p className=\"font-semibold\">No Song Loaded</p>\n                <p className=\"text-sm\">\n                  Change your Workout Type or check your connection status.\n                </p>\n              </div>\n            )}\n\n            <div>\n              <h3 className=\"text-white font-semibold mb-3 flex items-center\">\n                <Activity className=\"w-5 h-5 mr-2\" />\n                Queue (Matched to Your BPM)\n              </h3>\n              {spotifyToken ? (\n                <p className=\"text-xs text-green-300 mb-3\">\n                  Live Spotify recommendations updating with your heart rate.\n                </p>\n              ) : (\n                <p className=\"text-xs text-yellow-300 mb-3\">\n                  Using demo tracks. Connect Spotify for real music.\n                </p>\n              )}\n              {isFetchingTracks && spotifyToken && (\n                <div className=\"bg-green-900/20 border border-green-700 text-green-100 text-sm rounded-lg p-3 mb-3\">\n                  Syncing with Spotify&hellip;\n                </div>\n              )}\n              {trackError && (\n                <div className=\"bg-red-900/30 border border-red-700 text-red-100 text-sm rounded-lg p-3 mb-3\">\n                  {trackError}\n                </div>\n              )}\n              <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n                {queue.map((song, idx) => (\n                  <div\n                    key={song.id}\n                    className={`rounded-lg p-3 flex items-center justify-between transition-all ${\n                      currentSong?.id === song.id\n                        ? 'bg-green-600 shadow-lg'\n                        : 'bg-gray-700'\n                    }`}\n                  >\n                    <div className=\"flex items-center space-x-3 flex-1\">\n                      <div className=\"flex items-center justify-center w-8\">\n                        {currentSong?.id === song.id ? (\n                          <div className=\"flex space-x-0.5\">\n                            <div className=\"w-1 bg-white h-4 animate-pulse\"></div>\n                            <div\n                              className=\"w-1 bg-white h-3 animate-pulse\"\n                              style={{ animationDelay: '0.2s' }}\n                            ></div>\n                            <div\n                              className=\"w-1 bg-white h-5 animate-pulse\"\n                              style={{ animationDelay: '0.4s' }}\n                            ></div>\n                          </div>\n                        ) : (\n                          <span className=\"text-gray-400 text-sm\">\n                            {idx + 1}\n                          </span>\n                        )}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm font-medium truncate text-white\">\n                          {song.name}\n                        </p>\n                        <p\n                          className={`text-xs truncate ${\n                            currentSong?.id === song.id\n                              ? 'text-green-100'\n                              : 'text-gray-400'\n                          }`}\n                        >\n                          {song.artist}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                      <span\n                        className={`text-sm font-semibold ${\n                          currentSong?.id === song.id\n                            ? 'text-white'\n                            : 'text-green-400'\n                        }`}\n                      >\n                        {formatBpm(song.bpm)}\n                      </span>\n                      {currentSong?.id === song.id && (\n                        <Music className=\"w-4 h-4 text-white animate-pulse\" />\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-gray-800 rounded-2xl shadow-2xl p-6 border border-gray-700\">\n            <h2 className=\"text-xl font-semibold text-white mb-4\">\n              Workout Type\n            </h2>\n            <div className=\"space-y-3\">\n              {workoutTypes.map((workout) => (\n                <button\n                  key={workout.id}\n                  onClick={() => setSelectedWorkout(workout.id)}\n                  className={`w-full p-4 rounded-xl transition-all ${\n                    selectedWorkout === workout.id\n                      ? `${workout.color} text-white shadow-lg scale-105`\n                      : 'bg-gray-700 text-gray-300 hover:bg-gray-600'\n                  }`}\n                >\n                  <div className=\"flex items-center space-x-3\">\n                    <span className=\"text-2xl\">{workout.icon}</span>\n                    <div className=\"text-left flex-1\">\n                      <div className=\"font-semibold\">{workout.name}</div>\n                      <div\n                        className={`text-xs ${\n                          selectedWorkout === workout.id\n                            ? 'text-white/80'\n                            : 'text-gray-400'\n                        }`}\n                      >\n                        {workout.range}\n                      </div>\n                    </div>\n                  </div>\n                </button>\n              ))}\n            </div>\n\n            <div className=\"mt-6 bg-gray-700 rounded-lg p-4\">\n              <h3 className=\"text-white font-semibold mb-2 text-sm\">\n                How it works\n              </h3>\n              <p className=\"text-gray-400 text-xs leading-relaxed\">\n                As your heart rate changes during your workout, the app\n                automatically queues songs that match your current BPM, keeping\n                you in the zone.\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}